{"version":3,"sources":["../src/index.ts","../src/DragHandle.ts"],"sourcesContent":["import { DragHandle } from './DragHandle.js'\n\nexport * from './DragHandle.js'\n\nexport default DragHandle\n","import type { DragHandlePluginProps } from '@tiptap/extension-drag-handle'\nimport {\n  defaultComputePositionConfig,\n  DragHandlePlugin,\n  dragHandlePluginDefaultKey,\n} from '@tiptap/extension-drag-handle'\nimport type { Node } from '@tiptap/pm/model'\nimport type { Plugin, PluginKey } from '@tiptap/pm/state'\nimport type { Editor } from '@tiptap/vue-3'\nimport type { PropType } from 'vue'\nimport { defineComponent, h, nextTick, onBeforeUnmount, onMounted, ref, shallowRef } from 'vue'\n\ntype Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>\n\nexport type DragHandleProps = Omit<Optional<DragHandlePluginProps, 'pluginKey'>, 'element'> & {\n  class?: string\n  onNodeChange?: (data: { node: Node | null; editor: Editor; pos: number }) => void\n}\n\nexport const DragHandle = defineComponent({\n  name: 'DragHandleVue',\n\n  props: {\n    pluginKey: {\n      type: [String, Object] as PropType<PluginKey | string>,\n      default: dragHandlePluginDefaultKey,\n    },\n\n    editor: {\n      type: Object as PropType<DragHandleProps['editor']>,\n      required: true,\n    },\n\n    computePositionConfig: {\n      type: Object as PropType<DragHandleProps['computePositionConfig']>,\n      default: () => ({}),\n    },\n\n    onNodeChange: {\n      type: Function as PropType<DragHandleProps['onNodeChange']>,\n      default: null,\n    },\n\n    onElementDragStart: {\n      type: Function as PropType<DragHandleProps['onElementDragStart']>,\n      default: null,\n    },\n\n    onElementDragEnd: {\n      type: Function as PropType<DragHandleProps['onElementDragEnd']>,\n      default: null,\n    },\n\n    class: {\n      type: String as PropType<DragHandleProps['class']>,\n      default: 'drag-handle',\n    },\n  },\n\n  setup(props, { slots }) {\n    const root = ref<HTMLElement | null>(null)\n    const pluginHandle = shallowRef<{ plugin: Plugin; unbind: () => void } | null>(null)\n\n    onMounted(async () => {\n      await nextTick()\n\n      const { editor, pluginKey, onNodeChange, onElementDragEnd, onElementDragStart, computePositionConfig } = props\n\n      if (!root.value) {\n        return\n      }\n      if (!props.editor || props.editor.isDestroyed) {\n        return\n      }\n\n      const init = DragHandlePlugin({\n        editor,\n        element: root.value,\n        pluginKey,\n        computePositionConfig: { ...defaultComputePositionConfig, ...computePositionConfig },\n        onNodeChange,\n        onElementDragStart,\n        onElementDragEnd,\n      })\n\n      pluginHandle.value = init\n      props.editor.registerPlugin(init.plugin)\n    })\n\n    onBeforeUnmount(() => {\n      if (!pluginHandle.value) {\n        return\n      }\n\n      if (props.editor && !props.editor.isDestroyed) {\n        props.editor.unregisterPlugin(props.pluginKey)\n      }\n\n      pluginHandle.value.unbind?.()\n      pluginHandle.value = null\n    })\n\n    return () =>\n      h(\n        'div',\n        {\n          ref: root,\n          class: props.class,\n          style: { visibility: 'hidden', position: 'absolute' },\n          'data-dragging': 'false',\n        },\n        slots.default?.(),\n      )\n  },\n})\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACCA,mCAIO;AAKP,iBAA0F;AASnF,IAAM,iBAAa,4BAAgB;AAAA,EACxC,MAAM;AAAA,EAEN,OAAO;AAAA,IACL,WAAW;AAAA,MACT,MAAM,CAAC,QAAQ,MAAM;AAAA,MACrB,SAAS;AAAA,IACX;AAAA,IAEA,QAAQ;AAAA,MACN,MAAM;AAAA,MACN,UAAU;AAAA,IACZ;AAAA,IAEA,uBAAuB;AAAA,MACrB,MAAM;AAAA,MACN,SAAS,OAAO,CAAC;AAAA,IACnB;AAAA,IAEA,cAAc;AAAA,MACZ,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IAEA,oBAAoB;AAAA,MAClB,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IAEA,kBAAkB;AAAA,MAChB,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,IAEA,OAAO;AAAA,MACL,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,EACF;AAAA,EAEA,MAAM,OAAO,EAAE,MAAM,GAAG;AACtB,UAAM,WAAO,gBAAwB,IAAI;AACzC,UAAM,mBAAe,uBAA0D,IAAI;AAEnF,8BAAU,YAAY;AACpB,gBAAM,qBAAS;AAEf,YAAM,EAAE,QAAQ,WAAW,cAAc,kBAAkB,oBAAoB,sBAAsB,IAAI;AAEzG,UAAI,CAAC,KAAK,OAAO;AACf;AAAA,MACF;AACA,UAAI,CAAC,MAAM,UAAU,MAAM,OAAO,aAAa;AAC7C;AAAA,MACF;AAEA,YAAM,WAAO,+CAAiB;AAAA,QAC5B;AAAA,QACA,SAAS,KAAK;AAAA,QACd;AAAA,QACA,uBAAuB,EAAE,GAAG,2DAA8B,GAAG,sBAAsB;AAAA,QACnF;AAAA,QACA;AAAA,QACA;AAAA,MACF,CAAC;AAED,mBAAa,QAAQ;AACrB,YAAM,OAAO,eAAe,KAAK,MAAM;AAAA,IACzC,CAAC;AAED,oCAAgB,MAAM;AAzF1B;AA0FM,UAAI,CAAC,aAAa,OAAO;AACvB;AAAA,MACF;AAEA,UAAI,MAAM,UAAU,CAAC,MAAM,OAAO,aAAa;AAC7C,cAAM,OAAO,iBAAiB,MAAM,SAAS;AAAA,MAC/C;AAEA,+BAAa,OAAM,WAAnB;AACA,mBAAa,QAAQ;AAAA,IACvB,CAAC;AAED,WAAO,MAAG;AAtGd;AAuGM;AAAA,QACE;AAAA,QACA;AAAA,UACE,KAAK;AAAA,UACL,OAAO,MAAM;AAAA,UACb,OAAO,EAAE,YAAY,UAAU,UAAU,WAAW;AAAA,UACpD,iBAAiB;AAAA,QACnB;AAAA,SACA,WAAM,YAAN;AAAA,MACF;AAAA;AAAA,EACJ;AACF,CAAC;;;AD9GD,IAAO,gBAAQ;","names":[]}