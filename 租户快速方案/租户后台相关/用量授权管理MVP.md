# 功能需求文档：用量与授权管理 (MVP V1.0)

## 1. 功能概述 (Feature Overview)

“用量与授权”是一个为租户管理员设计的核心管理模块。MVP版本将专注于验证最核心的分配逻辑：
1.  管理员能够为团队设定一个通用的**资源消耗基线**，并为**特定个人**设置例外。
2.  管理员能够将有限的**高级功能席位**精确分配给**特定个人**。

此版本旨在以最小的成本，快速验证精细化权限管理的核心价值，并为后续更复杂的功能迭代收集真实的用户反馈。

---

## 2. 统一页面架构 (Unified Page Architecture)

### 2.1. 核心设计理念

为了在快速验证核心价值的同时，保持未来良好的可扩展性，MVP版本将采用**单页面布局**。

**设计 rationale**:
*   **避免过度设计**: 在初期可配置项较少（仅有“积分”和“UI操作指令”）的情况下，引入Tab或更复杂的导航会使界面显得空旷，增加不必要的用户操作。
*   **降低认知负荷**: 将所有可管理项集中于一页，让管理员一目了然，无需猜测不同分类下隐藏着什么内容，心流更顺畅。
*   **聚焦核心价值**: MVP的核心是验证“分配资源”与“授权功能”这两个核心流程，而非追求UI架构的完美。

所有功能配置项将以“卡片(Card)”的形式平铺在页面中，并通过二级标题进行逻辑分组，为未来新增更多卡片（如API调用量、存储空间等）预留了清晰的扩展空间。

### 2.2. 页面规格

| 架构元素           | 规格                                                     |
| :----------------- | :------------------------------------------------------- |
| **菜单入口**       | `用量与授权` (租户设置侧边栏中的一级菜单)              |
| **页面标题**       | `用量与授权`                                             |
| **页面描述**       | `在这里统一管理您团队的资源用量和功能使用权限。`         |
| **内容分组**       | **二级标题**: `资源用量分配` <br/> **二级标题**: `高级功能授权` |

---

## 3. 模块一：资源用量分配

### 3.1. 功能点：积分消耗上限

#### 3.1.1. 入口卡片

| 元素         | 规格                                           |
| :----------- | :--------------------------------------------- |
| **标题**     | `积分消耗上限`                                 |
| **描述**     | `为成员设置月度积分消耗上限，以精细化控制成本。` |
| **图标**     | `fas fa-coins` (或其它货币/积分相关图标)         |
| **操作按钮** | `[管理分配规则]`                               |

#### 3.1.2. 分配规则弹窗

**a. 按租户设置 (Default Tenant-wide Rule)**

这部分定义了全局默认规则，作为整个权限体系的基线。

| 设定         | UI 组件                                  | 默认状态              | 逻辑                                          |
| :----------- | :--------------------------------------- | :-------------------- | :-------------------------------------------- |
| 通用上限规则 | 单选框组                                 | `不限制` 被选中。     | 此为全局规则，优先级最低。                    |
| 选项1        | `(•) 不限制`                             | 选中                  |                                               |
| 选项2        | `( ) 每人最多` `[ 50000 ]` `点/月`         | 未选中，输入框有占位符 | 选中此项后输入框激活，否则禁用。              |

**b. 按白名单设置 (Whitelist-based Exceptions)**

白名单为管理员提供了打破全局规则的灵活性。在MVP版本中，我们将专注于最核心的**按个人设置例外**的场景。

*   **操作按钮**: `[+ 添加个人]`
*   **后续迭代规划 (V1.1+)**:
    *   将增加 `[+ 添加部门/组]` 按钮，支持按组织架构或虚拟角色组进行批量规则配置。
    *   届时将引入更复杂的冲突处理逻辑和优先级规则。

**c. 白名单规则列表详情**

| 动作         | 选择器 UI                                | 占位符/提示文本            | 数据源与呈现                                                 |
| :----------- | :--------------------------------------- | :------------------------- | :----------------------------------------------------------- |
| **添加个人** | 支持多选的搜索框                         | `按姓名/邮箱/手机号搜索成员` | 租户下所有成员。选中后以“标签(Tag)”形式显示在输入框内。       |
| **单条规则配置** | 单选框组：`( ) 不限制` `( ) 每人最多 [100000] 点/月` | -                          | 为每一条白名单规则独立配置。                                 |
| **删除规则**     | 图标按钮                                 | -                          | 每条规则行末提供一个`删除`图标按钮。                         |

---

## 4. 模块二：高级功能授权

### 4.1. 功能点：功能席位分配

#### 4.1.1. 入口卡片

| 元素             | 规格                                                       |
| :--------------- | :--------------------------------------------------------- |
| **功能名称**     | e.g., `UI操作指令`                                         |
| **功能图标**     | e.g., `fa-hand-pointer`                                    |
| **功能描述**     | e.g., `高级功能，用于操作手机和电脑的工作流指令。`         |
| **分配状态**     | `✅ 已为所有成员启用` 或 `X 席位已分配`                     |
| **操作按钮**     | `[管理分配]`                                               |

#### 4.1.2. 席位分配弹窗

**a. 规则配置**

| 设定类型               | UI 组件                             | 逻辑                                               |
| :--------------------- | :---------------------------------- | :------------------------------------------------- |
| **为所有成员启用**     | 开关 (Toggle)                       | 开启后，“按席位单独分配”区域禁用。此规则覆盖所有其他规则。 |
| **按席位单独分配：成员** | 支持多选的搜索框                    | 允许管理员精确地将有限的席位分配给特定成员。       |

*   **后续迭代规划 (V1.1+)**:
    *   将在此处增加“按部门分配”的选项，允许管理员为整个部门批量授予功能权限。

**b. 状态统计与操作**

| 动作           | UI & 逻辑                                                    |
| :------------- | :----------------------------------------------------------- |
| **席位统计**   | 弹窗底部实时显示 `已分配席位: X`。<br/>*MVP计算逻辑: 仅计算已选中的个人总数。* |
| **保存/取消**    | `[保存更改]` `[取消]` (标准弹窗操作)                         |

---

## 5. MVP规则详解与常见问题

### 5.1. MVP冲突规则

MVP版本的规则非常简单直接，只有两个优先级：

1.  **最高优先级**: **个人白名单**。如果一个成员在白名单中，则永远应用白名单中为他设置的规则。
2.  **最低优先级**: **全局默认规则**。如果一个成员不在任何白名单中，则应用“按租户设置”的全局规则。

### 5.2. 常见问题 (FAQ)

| 问题                                                               | 解答                                                                                                                                     |
| :----------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------- |
| **统一设置后，还能为个别人单独设置吗？**                           | **可以。** 这正是MVP的核心功能。您可以随时添加个人到白名单中，为他们设置不同于全局规则的上限。白名单规则永远优先生效。                    |
| **成员达到积分消耗上限后会怎样？**                                 | **将无法执行任何消耗积分的操作**（如AI对话、运行工作流等），直到下个月度周期额度重置。系统会给出明确的“积分不足”提示。                        |
| **设置上限时，若某成员本月已消耗的积分已超额，会发生什么？**         | **规则可设置成功。** 该成员在本月剩余时间内将无法再消耗任何积分，但不影响已完成的操作。                                                          |
