<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ant Design äº¤äº’å¼æƒé™ç”³è¯·åŸå‹</title>
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Ant Design (Updated Version) -->
    <script src="https://unpkg.com/dayjs@1.11.10/dayjs.min.js"></script>
    <script src="https://unpkg.com/antd@5.19.1/dist/antd.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/antd@5.19.1/dist/reset.css" />
    <!-- Ant Design Icons -->
    <script src="https://unpkg.com/@ant-design/icons@5.3.6/dist/index.umd.min.js"></script>
    <!-- Tailwind for layout -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="root" class="p-4"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;
        const { Button, Card, Typography, Modal, Steps, Form, Input, Alert, Space, App: AntApp, ConfigProvider, theme, message, Tag, Avatar } = antd;
        const { Title, Text } = Typography;
        const { ClockCircleOutlined, CloseCircleOutlined, UserOutlined } = icons;

        const MainApp = () => {
            // --- STATE MANAGEMENT ---
            const [applicationState, setApplicationState] = useState('NOT_APPLIED'); // 'NOT_APPLIED', 'PENDING', 'REJECTED', 'APPROVED'
            const [applicationReason, setApplicationReason] = useState('');
            const [isApplicationModalOpen, setIsApplicationModalOpen] = useState(false);
            const [isCreateSpaceModalOpen, setIsCreateSpaceModalOpen] = useState(false);
            
            const [form] = Form.useForm();
            const rejectionReason = 'ç®¡ç†å‘˜è®¤ä¸ºè¯¥ç”³è¯·çš„ä¸šåŠ¡åœºæ™¯æè¿°ä¸å¤Ÿæ¸…æ™°ï¼Œéœ€è¦è¡¥å……æ›´è¯¦ç»†çš„è¯´æ˜ã€‚';

            // --- EVENT HANDLERS ---
            const handleCreateSpaceClick = () => {
                if (applicationState === 'APPROVED') {
                    setIsCreateSpaceModalOpen(true);
                } else {
                    setIsApplicationModalOpen(true);
                }
            };
            
            const handleApplicationModalCancel = () => {
                setIsApplicationModalOpen(false);
            };

            const handleFormSubmit = (values) => {
                setApplicationReason(values.reason);
                setApplicationState('PENDING');
                message.loading({ content: 'æ­£åœ¨æäº¤ç”³è¯·...', key: 'submitting' });
                setTimeout(() => {
                    message.success({ content: 'ç”³è¯·å·²æäº¤!', key: 'submitting', duration: 2 });
                }, 1000);
            };

            const handleWithdraw = () => {
                setApplicationState('NOT_APPLIED');
                handleApplicationModalCancel();
                message.info('æ‚¨å·²æ’¤é”€ç”³è¯·ã€‚');
            };

            const handleReapply = () => {
                setApplicationState('NOT_APPLIED');
            };
            
            // --- ADMIN PANEL HANDLERS ---
            const handleApprove = () => {
                setApplicationState('APPROVED');
                setIsApplicationModalOpen(false);
                message.success('ç”³è¯·å·²æ‰¹å‡†ï¼');
            };
            
            const handleReject = () => {
                setApplicationState('REJECTED');
            };

            const handleReset = () => {
                setApplicationState('NOT_APPLIED');
                setApplicationReason('');
                form.resetFields();
                message.success('çŠ¶æ€å·²é‡ç½®ã€‚');
            };

            const modalTitle = useMemo(() => {
                switch (applicationState) {
                    case 'PENDING':
                        return 'ç”³è¯·çŠ¶æ€ï¼šå®¡æ‰¹ä¸­';
                    case 'REJECTED':
                        return 'ç”³è¯·çŠ¶æ€ï¼šå·²é©³å›';
                    case 'NOT_APPLIED':
                    default:
                        return 'ç”³è¯·åˆ›å»ºç©ºé—´æƒé™';
                }
            }, [applicationState]);


            // --- MODAL CONTENT RENDERING ---
            const ModalContent = () => {
                if (applicationState === 'PENDING') {
                    return (
                        <div className="text-center py-4">
                            <ClockCircleOutlined style={{ fontSize: '40px', color: '#1677ff' }} className="mb-3" />
                            <div className="text-base font-semibold text-gray-800">ç”³è¯·å·²æäº¤ï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ‰¹</div>
                            <Alert 
                                className="mt-4 mb-6 text-left"
                                message={<span className="font-bold text-sm">è¯·æ³¨æ„ï¼šå®¡æ‰¹é€šè¿‡åï¼Œæ­¤å¼¹çª—å°†ä¸å†å‡ºç°ã€‚</span>}
                                description={<span className="leading-tight block mt-1 text-sm">æ‚¨å†æ¬¡ç‚¹å‡»ã€æ–°å»ºç©ºé—´ã€‘æŒ‰é’®æ—¶ï¼Œå°†ç›´æ¥æ‰“å¼€åˆ›å»ºç©ºé—´çš„é¡µé¢ã€‚</span>}
                                type="warning"
                                showIcon
                            />
                            <Card size="small" className="text-left bg-gray-50 border-gray-200">
                                <p className="text-xs text-gray-500">æ‚¨æäº¤çš„åŸå› ï¼š</p>
                                <p className="mt-1 text-sm text-gray-800">{applicationReason || '(æœªå¡«å†™)'}</p>
                            </Card>
                        </div>
                    );
                }
                
                if (applicationState === 'REJECTED') {
                    return (
                         <div className="text-center py-4">
                            <CloseCircleOutlined style={{ fontSize: '40px', color: '#ff4d4f' }} className="mb-3" />
                             <div className="text-base font-semibold text-red-600">æŠ±æ­‰ï¼Œæ‚¨çš„ç”³è¯·å·²è¢«é©³å›</div>
                            <Space direction="vertical" className="w-full text-left mt-6" size="middle">
                                <Alert
                                    message={<span className="font-bold text-sm">é©³å›åŸå› </span>}
                                    description={<span className="mt-1 block text-sm">{rejectionReason}</span>}
                                    type="error"
                                    showIcon
                                />
                                <Card size="small" className="text-left bg-gray-50 border-gray-200">
                                     <p className="text-xs text-gray-500">æ‚¨æäº¤çš„åŸå› ï¼š</p>
                                     <p className="mt-1 text-sm text-gray-800">{applicationReason || '(æœªå¡«å†™)'}</p>
                                </Card>
                            </Space>
                        </div>
                    );
                }

                // Default is 'NOT_APPLIED'
                return (
                    <div className="pt-2">
                        <Alert
                            message={<span className="text-sm">ä¸ºç¡®ä¿èµ„æºåˆç†ä½¿ç”¨ï¼Œæ‚¨éœ€è¦å…ˆæäº¤ç”³è¯·ã€‚å®¡æ‰¹é€šè¿‡åï¼Œã€æ–°å»ºç©ºé—´ã€‘æŒ‰é’®å³å¯ä¸ºæ‚¨æ­£å¸¸ä½¿ç”¨ã€‚</span>}
                            type="info"
                            showIcon
                            className="mb-6"
                        />
                        <div className="mb-1 flex items-center">
                            <Text type="secondary" className="text-sm">å®¡æ‰¹äºº: </Text>
                            <Space align="center" className="ml-2">
                                <Avatar size="small" icon={<UserOutlined />} />
                                <span className="text-sm text-gray-800">ç‹å®</span>
                            </Space>
                        </div>
                        <Form form={form} layout="vertical" onFinish={handleFormSubmit} className="mt-4">
                            <Form.Item
                                label={<span className="text-sm">ç”³è¯·åŸå› </span>}
                                name="reason"
                                initialValue={applicationReason}
                                rules={[{ required: true, message: 'ç”³è¯·åŸå› ä¸èƒ½ä¸ºç©ºï¼' }]}
                            >
                                <Input.TextArea 
                                    rows={4} 
                                    placeholder="è¯·è¯¦ç»†æè¿°æ‚¨ç”³è¯·å›¢é˜Ÿç©ºé—´çš„ä¸šåŠ¡éœ€æ±‚å’Œåœºæ™¯..." 
                                    className="text-sm"
                                    maxLength={200}
                                    showCount
                                />
                            </Form.Item>
                        </Form>
                    </div>
                );
            };

            const modalSteps = useMemo(() => {
                let current = 0;
                let status = 'process';

                if (applicationState === 'PENDING') {
                    current = 1;
                    status = 'process';
                } else if (applicationState === 'REJECTED') {
                    current = 1;
                    status = 'error';
                } else if (applicationState === 'NOT_APPLIED') {
                    current = 0;
                    status = 'process';
                }
                
                return { current, status };

            }, [applicationState]);

            const modalFooter = useMemo(() => {
                 if (applicationState === 'PENDING') {
                    return [
                        <Button key="close" type="primary" onClick={handleApplicationModalCancel}>å…³é—­</Button>,
                    ];
                }
                if (applicationState === 'REJECTED') {
                     return [
                        <Button key="close" onClick={handleApplicationModalCancel}>å…³é—­</Button>,
                        <Button key="reapply" type="primary" onClick={handleReapply}>è¿”å›ä¿®æ”¹ç”³è¯·</Button>,
                    ];
                }
                return [
                    <Button key="cancel" onClick={handleApplicationModalCancel}>å–æ¶ˆ</Button>,
                    <Button key="submit" type="primary" onClick={() => form.submit()}>æäº¤ç”³è¯·</Button>,
                ];
            }, [applicationState, form]);
            
            // --- RENDER ---
            return (
                <div className="min-h-screen flex flex-col items-center justify-center">
                    <Card style={{ width: '100%', maxWidth: '896px' }}>
                        <div className="flex justify-between items-center mb-6">
                            <Title level={2}>æˆ‘çš„å·¥ä½œå°</Title>
                            <Button type="primary" size="large" onClick={handleCreateSpaceClick}>+ æ–°å»ºç©ºé—´</Button>
                        </div>
                        <Card className="bg-gray-50">
                             <Title level={5} className="mb-4">ç©ºé—´åˆ—è¡¨</Title>
                             <div className="text-center text-gray-500 py-10 border-2 border-dashed rounded-lg">
                                <p>æ‚¨è¿˜æ²¡æœ‰ä»»ä½•ç©ºé—´ã€‚</p>
                                <p className="text-sm mt-1">ç‚¹å‡»å³ä¸Šè§’çš„â€œæ–°å»ºç©ºé—´â€å¼€å§‹åˆ›å»ºå§ï¼</p>
                            </div>
                        </Card>
                    </Card>

                    <Card style={{ width: '100%', maxWidth: '896px' }} className="mt-8 bg-yellow-50 border-yellow-300">
                         <div className="text-center">
                            <Title level={5} className="text-yellow-800">ğŸ‘¨â€ğŸ’» ç®¡ç†å‘˜æ¨¡æ‹Ÿé¢æ¿</Title>
                            <Text type="secondary" className="mb-4 block">æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ¨¡æ‹Ÿç®¡ç†å‘˜æ“ä½œï¼Œä»¥æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æµç¨‹ã€‚</Text>
                            <Space size="large">
                                <Button type="primary" ghost disabled={applicationState !== 'PENDING'} onClick={handleApprove} className="bg-green-500 !text-white border-green-500 disabled:!bg-gray-300 disabled:!text-gray-500 disabled:!border-gray-300">æ‰¹å‡†ç”³è¯·</Button>
                                <Button type="primary" danger ghost disabled={applicationState !== 'PENDING'} onClick={handleReject}>é©³å›ç”³è¯·</Button>
                                <Button onClick={handleReset}>é‡ç½®çŠ¶æ€</Button>
                            </Space>
                            <Text className="mt-3 block font-semibold text-gray-600">å½“å‰çŠ¶æ€: {applicationState}</Text>
                        </div>
                    </Card>

                    <Modal
                        title={<span className="text-base font-semibold">{modalTitle}</span>}
                        open={isApplicationModalOpen}
                        onCancel={handleApplicationModalCancel}
                        footer={modalFooter}
                        width={520}
                        destroyOnClose
                    >
                       <Steps
                           current={modalSteps.current}
                           status={modalSteps.status}
                           items={[
                               { title: <span className="text-sm">å¡«å†™ç”³è¯·</span> },
                               { title: <span className="text-sm">ç­‰å¾…å®¡æ‰¹</span> },
                           ]}
                           className="mb-6 mt-4"
                       />
                       <ModalContent />
                    </Modal>

                    <Modal
                        title="åˆ›å»ºæ–°çš„å›¢é˜Ÿç©ºé—´"
                        open={isCreateSpaceModalOpen}
                        onOk={() => {
                            message.success('ç©ºé—´åˆ›å»ºæˆåŠŸ!');
                            setIsCreateSpaceModalOpen(false);
                        }}
                        onCancel={() => setIsCreateSpaceModalOpen(false)}
                        okText="ç«‹å³åˆ›å»º"
                        cancelText="å–æ¶ˆ"
                    >
                         <Alert message="æ‚¨çš„æƒé™ç”³è¯·å·²é€šè¿‡ï¼ç°åœ¨å¯ä»¥åˆ›å»ºç©ºé—´äº†ã€‚" type="success" showIcon className="mb-6"/>
                         <Form layout="vertical">
                            <Form.Item label="ç©ºé—´åç§°" required>
                                <Input placeholder="è¯·è¾“å…¥ç©ºé—´åç§°" />
                            </Form.Item>
                             <Form.Item label="ç©ºé—´ç®€ä»‹">
                                <Input.TextArea rows={3} placeholder="è¯·è¾“å…¥ç©ºé—´ç®€ä»‹" />
                            </Form.Item>
                         </Form>
                    </Modal>

                </div>
            );
        };
        
        // This is a wrapper to use Ant Design's App context (for message, notification, etc.)
        const AppWrapper = () => (
             <ConfigProvider theme={{
                token: {
                    colorPrimary: '#1677ff', // Ant Design's default blue
                    fontFamily: "'Inter', 'Helvetica Neue', 'Helvetica', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif",
                },
             }}>
                <AntApp>
                    <MainApp />
                </AntApp>
            </ConfigProvider>
        );

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<AppWrapper />);
    </script>
</body>
</html>

