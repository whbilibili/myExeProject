<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>应用权限管理</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 使用Inter字体 (如果可用) */
        body {
            font-family: "Inter", "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
        }
        /* 自定义下拉菜单的显示/隐藏 */
        .dropdown-menu {
            display: none;
            position: fixed; /* 使用fixed确保它在所有元素之上 */
            z-index: 50;
        }
        .dropdown-menu.show {
            display: block;
        }
    </style>
</head>
<body class="p-8">

    <!-- 弹窗容器 (模仿弹窗样式) -->
    <div class="w-full max-w-7xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden">

        <!-- 1. 顶部提示语 -->
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4" role="alert">
            <p class="text-sm text-blue-700">
                1. 应用权限默认从空间继承，当一个人同时拥有两个角色时，按最高权限算。
            </p>
            <p class="text-sm text-blue-700 mt-1">
                2. 当前部分成员权限已独立设置，<button class="font-semibold text-blue-800 underline hover:text-blue-600">点击此处全部恢复继承</button>。
            </p>
        </div>

        <!-- 2. 内容区 (双栏布局) -->
        <div class="grid grid-cols-1 lg:grid-cols-2">
            
            <!-- 2.1. 个人权限 (左栏) -->
            <div class="p-6 border-r border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">个人权限</h2>
                
                <!-- 操作栏 -->
                <div class="flex flex-col md:flex-row gap-2 mb-4">
                    <input type="text" placeholder="按用户名搜索" class="flex-grow border border-gray-300 rounded-md p-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <input type="text" placeholder="请选择角色" class="border border-gray-300 rounded-md p-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <button class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-indigo-700 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500">
                        + 添加个人
                    </button>
                </div>

                <!-- 成员列表 -->
                <div id="member-list" class="space-y-3">
                    <!-- 列表项将由JS动态生成 -->
                </div>
                
                <!-- 列表底部 (分页) -->
                <div class="flex justify-between items-center mt-6 text-sm text-gray-600">
                    <span>共 <span id="member-count">0</span> 条</span>
                    <div class="flex items-center space-x-2">
                        <button class="px-2 py-1 rounded-md hover:bg-gray-100 disabled:opacity-50" disabled>&lt;</button>
                        <span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-md font-medium">1</span>
                        <button class="px-2 py-1 rounded-md hover:bg-gray-100">&gt;</button>
                        <span>20 条/页 ▽</span>
                    </div>
                </div>
            </div>
            
            <!-- 2.2. 部门权限 (右栏) -->
            <div class="p-6 bg-gray-50">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">部门权限</h2>
                
                <!-- 操作栏 -->
                <div class="flex flex-col md:flex-row gap-2 mb-4">
                    <input type="text" placeholder="按部门名称搜索" class="flex-grow border border-gray-300 rounded-md p-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <input type="text" placeholder="请选择角色" class="border border-gray-300 rounded-md p-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <button class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-indigo-700 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500">
                        + 添加部门
                    </button>
                </div>
                
                <!-- 部门列表 (模拟) -->
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-4 bg-white rounded-md border">
                        <div class="flex items-center">
                            <span class="flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-700 rounded-full mr-3 font-medium">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                  <path d="M3.75 21v-3.004A3.75 3.75 0 017.5 14.25h9a3.75 3.75 0 013.75 3.75V21m-15 0h15M12 14.25c-2.485 0-4.5-2.015-4.5-4.5s2.015-4.5 4.5-4.5 4.5 2.015 4.5 4.5-2.015 4.5-4.5 4.5z" />
                                </svg>
                            </span>
                            <span class="font-medium text-gray-800">研发部</span>
                            <span class="ml-2 px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">继承</span>
                        </div>
                        <span class="text-sm text-gray-500">管理员</span>
                        <span class="text-sm text-gray-500">2025-06-30 15:25:38</span>
                    </div>
                     <div class="flex items-center justify-between p-4 bg-white rounded-md border">
                        <div class="flex items-center">
                            <span class="flex items-center justify-center w-8 h-8 bg-green-100 text-green-700 rounded-full mr-3 font-medium">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                  <path d="M3.75 21v-3.004A3.75 3.75 0 017.5 14.25h9a3.75 3.75 0 013.75 3.75V21m-15 0h15M12 14.25c-2.485 0-4.5-2.015-4.5-4.5s2.015-4.5 4.5-4.5 4.5 2.015 4.5 4.5-2.015 4.5-4.5 4.5z" />
                                </svg>
                            </span>
                            <span class="font-medium text-gray-800">市场部</span>
                             <span class="ml-2 px-2 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">独立</span>
                        </div>
                        <span class="text-sm text-gray-500">编辑者</span>
                        <span class="text-sm text-gray-500">2025-10-29 20:17:00</span>
                    </div>
                </div>

            </div>
        </div>

    </div>


    <!-- 
      =======================================================
      全局自定义下拉菜单 (Key Feature 2, 3, 4)
      =======================================================
    -->
    <div id="role-menu" class="dropdown-menu w-72 bg-white rounded-md shadow-lg border border-gray-200">
        <div class="p-2">
            <input type="text" placeholder="Search" class="w-full border border-gray-300 rounded-md p-2 text-sm focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        
        <div id="role-options" class="py-1">
            <!-- 角色将由JS动态生成 (模拟 image_a0e093.png) -->
        </div>
        
        <div class="border-t border-gray-100 py-2">
            <button id="action-remove" class="w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM6.75 9.25a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5z" clip-rule="evenodd" />
                </svg>
                移除权限
            </button>
            <button id="action-restore" class="w-full flex items-center px-4 py-2 text-sm text-blue-600 hover:bg-blue-50">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2">
                  <path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201-4.752.5.5 0 01.993.103 4.5 4.5 0 007.41 3.578.5.5 0 01.8-.627zM6.536 4.903a.5.5 0 010 .707L4.707 7.44a.5.5 0 01-.707-.707l1.829-1.829a.5.5 0 01.707 0zM13.464 15.097a.5.5 0 010-.707l1.829-1.829a.5.5 0 11.707.707l-1.829 1.829a.5.5 0 01-.707 0zM10 15.5a.5.5 0 01.5.5v2.5a.5.5 0 01-1 0v-2.5a.5.5 0 01.5-.5zM4.5 10a.5.5 0 00-.5.5v2.5a.5.5 0 001 0v-2.5a.5.5 0 00-.5-.5zM15.5 10a.5.5 0 00-.5.5v2.5a.5.5 0 001 0v-2.5a.5.5 0 00-.5-.5zM7.05 13.95a.5.5 0 01.707 0l1.829 1.829a.5.5 0 11-.707.707L7.05 14.657a.5.5 0 010-.707z" clip-rule="evenodd" />
                </svg>
                恢复继承
            </button>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- 1. 模拟数据 ---
    
    // 角色定义 (Key Feature 3)
    const roleDefinitions = [
        { 
            key: "所有者", 
            desc: "拥有全部控制权，包括配置和删除。", 
            icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-purple-600"><path fill-rule="evenodd" d="M10 1a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0V1.75A.75.75 0 0110 1zM5.05 5.05a.75.75 0 011.06 0l2.122 2.121a.75.75 0 01-1.06 1.06L5.05 6.11a.75.75 0 010-1.06zM3.25 10a.75.75 0 01.75-.75h3.5a.75.75 0 010 1.5h-3.5a.75.75 0 01-.75-.75zM5.05 14.95a.75.75 0 010-1.06l2.121-2.122a.75.75 0 011.06 1.06L6.11 14.95a.75.75 0 01-1.06 0zM10 16.75a.75.75 0 01-.75.75v3.5a.75.75 0 011.5 0v-3.5a.75.75 0 01-.75-.75zM14.95 14.95a.75.75 0 01-1.06 0l-2.122-2.121a.75.75 0 111.06-1.06l2.122 2.121a.75.75 0 010 1.06zM16.75 10a.75.75 0 01-.75.75h-3.5a.75.75 0 010-1.5h3.5a.75.75 0 01.75.75zM14.95 5.05a.75.75 0 010 1.06l-2.121 2.122a.75.75 0 01-1.06-1.06L13.89 5.05a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg>` 
        },
        { 
            key: "管理员", 
            desc: "可以配置此应用，但不能删除它。", 
            icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-blue-600"><path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.78 6.125-2.095a1.23 1.23 0 00.41-1.412A9.99 9.99 0 0010 12.75a9.99 9.99 0 00-6.535 1.743z" /></svg>` 
        },
        { 
            key: "编辑者", 
            desc: "可以添加、编辑和删除记录。", 
            icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-green-600"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zM6 8a2 2 0 11-4 0 2 2 0 014 0zM1.49 15.326a.75.75 0 011.21-.734A11.05 11.05 0 006 16.75a.75.75 0 010 1.5 12.55 12.55 0 01-5.02-1.256.75.75 0 01.22-.668zM14 8a2 2 0 11-4 0 2 2 0 014 0zM8.51 15.326a.75.75 0 011.21-.734c.15.082.3.16.44.234.14-.074.29-.152.44-.234a.75.75 0 011.21.734A11.05 11.05 0 0014 16.75a.75.75 0 010 1.5 12.55 12.55 0 01-5.02-1.256.75.75 0 01.22-.668z" clip-rule="evenodd" /></svg>` 
        },
        { 
            key: "查看与评论", 
            desc: "可以查看和评论记录。", 
            icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-yellow-600"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z" clip-rule="evenodd" /></svg>` 
        },
        { 
            key: "仅查看", 
            desc: "只能查看记录。", 
            icon: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-gray-500"><path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" /><path fill-rule="evenodd" d="M.664 10.59a1.651 1.651 0 010-1.18l.879-.654A9.954 9.954 0 0110 5.5c1.294 0 2.55.19 3.758.55l.879.653a1.651 1.651 0 010 1.18l-.879.654A9.954 9.954 0 0110 14.5c-1.294 0-2.55-.19-3.758-.55l-.879-.653zM10 13c1.034 0 2.02.138 2.94.406l.468.35a.151.151 0 000 .108l-.468.35A8.454 8.454 0 0010 13zM7.06 6.594A8.454 8.454 0 0010 7c1.034 0 2.02.138 2.94.406l.468.35a.151.151 0 000 .108l-.468.35A8.454 8.454 0 0010 7z" clip-rule="evenodd" /></svg>` 
        }
    ];

    // 模拟成员列表数据
    const members = [
        { id: 1, name: "aaa", role: "管理员", date: "2024-09-30 10:50:26", status: "继承" },
        { id: 2, name: "王尼", role: "管理员", date: "2025-04-16 21:01:25", status: "独立" },
        { id: 3, name: "王最", role: "管理员", date: "2025-10-29 20:17:00", status: "继承" },
        { id: 4, name: "王俊杰", role: "管理员", date: "2025-10-29 20:17:00", status: "独立" },
        { id: 5, name: "王德炮", role: "管理员", date: "2025-10-29 20:17:00", status: "继承" },
        { id: 6, name: "王新乐", role: "管理员", date: "2025-10-29 20:17:00", status: "继承" },
        { id: 7, name: "王雨苗", role: "管理员", date: "2025-10-29 20:17:00", status: "独立" },
        { id: 8, name: "王晓娟", role: "管理员", date: "2025-10-29 20:17:00", status: "继承" },
        { id: 9, name: "王琳青", role: "管理员", date: "2025-10-29 20:17:00", status: "继承" },
        { id: 10, name: "王超", role: "管理员", date: "2025-10-29 20:17:00", status: "独立" },
        { id: 11, name: "王书友", role: "管理员", date: "2025-10-29 20:17:00", status: "继承" },
        { id: 12, name: "王博澳", role: "管理员", date: "2025-10-29 20:17:00", status: "继承" },
        { id: 13, name: "王凯", role: "管理员", date: "2025-10-29 20:17:00", status: "独立" },
        { id: 14, name: "李耀宗", role: "访客", date: "2025-10-29 20:46:02", status: "继承" }
    ];

    // --- 2. 获取 DOM 元素 ---
    const memberList = document.getElementById('member-list');
    const memberCount = document.getElementById('member-count');
    const roleMenu = document.getElementById('role-menu');
    const roleOptions = document.getElementById('role-options');
    const actionRestore = document.getElementById('action-restore');
    let currentDropdownToggle = null; // 追踪当前打开的按钮

    // --- 3. 渲染函数 ---

    // 渲染成员列表
    function renderMembers() {
        memberList.innerHTML = ''; // 清空列表
        members.forEach(member => {
            const isInherit = member.status === '继承';
            const tagClass = isInherit 
                ? 'bg-blue-100 text-blue-800' 
                : 'bg-orange-100 text-orange-800';
            
            const memberHtml = `
                <div class="flex items-center justify-between p-4 bg-white rounded-md border">
                    <div class="flex items-center">
                        <img src="https://placehold.co/40x40/${isInherit ? 'a5f3fc/0c4a6e' : 'fee2d5/7c2d1e'}?text=${member.name.charAt(0)}" alt="avatar" class="w-8 h-8 rounded-full mr-3">
                        <span class="font-medium text-gray-800 mr-2">${member.name}</span>
                        <!-- Key Feature 1: 标签 -->
                        <span class="px-2 py-0.5 rounded-full text-xs font-medium ${tagClass}">${member.status}</span>
                    </div>
                    <div class="flex items-center space-x-6">
                        <!-- Key Feature 2: 自定义下拉框触发器 -->
                        <button 
                            class="role-dropdown-toggle text-sm font-medium text-gray-700 flex items-center" 
                            data-member-id="${member.id}"
                            data-member-status="${member.status}"
                        >
                            <span class="current-role">${member.role}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-gray-500 ml-1"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0L5.23 8.29a.75.75 0 01.02-1.06z" clip-rule="evenodd" /></svg>
                        </button>
                        <span class="text-sm text-gray-500 hidden md:block">${member.date}</span>
                    </div>
                </div>
            `;
            memberList.insertAdjacentHTML('beforeend', memberHtml);
        });
        memberCount.textContent = members.length;
    }

    // 渲染角色下拉菜单 (Key Feature 3)
    function renderRoleMenu(currentRole) {
        roleOptions.innerHTML = '';
        roleDefinitions.forEach(role => {
            const isSelected = role.key === currentRole;
            const selectedClass = isSelected ? 'bg-indigo-50 text-indigo-700' : 'text-gray-700';
            
            const optionHtml = `
                <button 
                    class="role-option w-full flex items-start text-left px-3 py-3 hover:bg-gray-50 ${selectedClass}"
                    data-new-role="${role.key}"
                >
                    <div class="mr-3 mt-0.5">${role.icon}</div>
                    <div class="flex-1">
                        <div class="font-semibold flex items-center">
                            <span>${role.key}</span>
                            ${isSelected ? '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-indigo-600 ml-auto"><path fill-rule="evenodd" d="M16.704 5.296a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06 0l-3.5-3.5a.75.75 0 011.06-1.06L9 12.94l6.97-6.97a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg>' : ''}
                        </div>
                        <p class="text-xs text-gray-500">${role.desc}</p>
                    </div>
                </button>
            `;
            roleOptions.insertAdjacentHTML('beforeend', optionHtml);
        });
    }

    // --- 4. 事件监听 ---

    // 显示/隐藏下拉菜单 (主逻辑)
    memberList.addEventListener('click', (e) => {
        const toggleButton = e.target.closest('.role-dropdown-toggle');
        
        if (toggleButton) {
            e.stopPropagation(); // 防止触发 window 的点击事件
            
            // 如果点击的是同一个按钮，则关闭
            if (currentDropdownToggle === toggleButton) {
                roleMenu.classList.remove('show');
                currentDropdownToggle = null;
                return;
            }
            
            currentDropdownToggle = toggleButton;
            const memberId = toggleButton.dataset.memberId;
            const status = toggleButton.dataset.memberStatus;
            const currentRole = toggleButton.querySelector('.current-role').textContent;

            // 渲染菜单内容
            renderRoleMenu(currentRole);
            
            // Key Feature 4: 条件逻辑
            if (status === '独立') {
                actionRestore.style.display = 'flex';
            } else {
                actionRestore.style.display = 'none';
            }
            
            // 绑定数据到菜单，以便后续操作
            roleMenu.dataset.memberId = memberId;
            roleMenu.dataset.toggleButton = toggleButton; // 存按钮引用
            
            // 定位
            const rect = toggleButton.getBoundingClientRect();
            roleMenu.style.top = `${rect.bottom + 4}px`;
            
            // 计算右对齐
            const menuWidth = roleMenu.offsetWidth; // 宽度在 CSS 中是 w-72 (288px)
            roleMenu.style.left = `${rect.right - 288}px`; 
            
            roleMenu.classList.add('show');
        }
    });

    // 全局点击，关闭菜单
    window.addEventListener('click', () => {
        if (roleMenu.classList.contains('show')) {
            roleMenu.classList.remove('show');
            currentDropdownToggle = null;
        }
    });

    // 阻止菜单内部点击导致关闭
    roleMenu.addEventListener('click', (e) => {
        e.stopPropagation();
    });

    // 菜单项点击：选择角色
    roleOptions.addEventListener('click', (e) => {
        const optionButton = e.target.closest('.role-option');
        if (!optionButton) return;
        
        const newRole = optionButton.dataset.newRole;
        const memberId = roleMenu.dataset.memberId;
        
        // 1. 更新数据 (模拟)
        const member = members.find(m => m.id == memberId);
        member.role = newRole;
        
        // 2. 更新按钮文本
        if (currentDropdownToggle) {
            currentDropdownToggle.querySelector('.current-role').textContent = newRole;
        }
        
        // 3. 关闭菜单
        roleMenu.classList.remove('show');
        currentDropdownToggle = null;
    });
    
    // 菜单项点击：操作
    document.getElementById('action-remove').addEventListener('click', () => {
        alert(`移除了ID: ${roleMenu.dataset.memberId} 的权限`);
        roleMenu.classList.remove('show');
        currentDropdownToggle = null;
    });
    
    actionRestore.addEventListener('click', () => {
        alert(`恢复了ID: ${roleMenu.dataset.memberId} 的继承`);
        roleMenu.classList.remove('show');
        currentDropdownToggle = null;
    });

    // --- 5. 初始加载 ---
    renderMembers();

});
</script>

</body>
</html>
