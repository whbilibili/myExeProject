<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®æµ‹è¯•é¡µé¢</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h2 {
      color: #333;
      border-bottom: 2px solid #1890ff;
      padding-bottom: 10px;
    }
    .avatar-test {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .avatar-test img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 2px solid #ddd;
    }
    .data-item {
      padding: 10px;
      background: #f9f9f9;
      margin: 5px 0;
      border-left: 3px solid #1890ff;
    }
    .error {
      color: #ff4d4f;
      background: #fff2f0;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ffccc7;
    }
    .success {
      color: #52c41a;
      background: #f6ffed;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #b7eb8f;
    }
    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      max-height: 300px;
    }
  </style>
</head>
<body>
  <h1>ğŸ” æ•°æ®è¯Šæ–­æµ‹è¯•é¡µé¢</h1>
  
  <div class="section">
    <h2>1. å¤´åƒåŠ è½½æµ‹è¯•</h2>
    <p>æµ‹è¯•Pravatarå¤´åƒæœåŠ¡æ˜¯å¦å¯ç”¨ï¼š</p>
    <div class="avatar-test" id="avatarTest"></div>
    <div id="avatarStatus"></div>
  </div>

  <div class="section">
    <h2>2. MockDataæ•°æ®ç”Ÿæˆæµ‹è¯•</h2>
    <div id="mockDataStatus"></div>
    <div id="mockDataDetails"></div>
  </div>

  <div class="section">
    <h2>3. ç”¨æˆ·æ•°æ®æµ‹è¯•</h2>
    <div id="userDataStatus"></div>
    <div id="userDataDetails"></div>
  </div>

  <div class="section">
    <h2>4. æ¶ˆè´¹è®°å½•æµ‹è¯•</h2>
    <div id="consumptionStatus"></div>
    <div id="consumptionDetails"></div>
  </div>

  <div class="section">
    <h2>5. ç¬¬ä¸€ä¸ªç”¨æˆ·è¯¦ç»†ä¿¡æ¯</h2>
    <div id="firstUserDetails"></div>
  </div>

  <!-- åŠ è½½JS -->
  <script src="./assets/js/utils.js"></script>
  <script src="./assets/js/mock-data.js"></script>

  <script>
    // 1. æµ‹è¯•å¤´åƒåŠ è½½
    function testAvatars() {
      const container = document.getElementById('avatarTest');
      const statusDiv = document.getElementById('avatarStatus');
      
      let loadedCount = 0;
      let errorCount = 0;
      
      for (let i = 1; i <= 10; i++) {
        const img = document.createElement('img');
        const url = `https://i.pravatar.cc/150?img=${i}`;
        img.src = url;
        img.alt = `Avatar ${i}`;
        img.title = url;
        
        img.onload = () => {
          loadedCount++;
          updateAvatarStatus();
        };
        
        img.onerror = () => {
          errorCount++;
          img.style.border = '2px solid red';
          updateAvatarStatus();
        };
        
        container.appendChild(img);
      }
      
      function updateAvatarStatus() {
        if (loadedCount + errorCount === 10) {
          if (errorCount === 0) {
            statusDiv.innerHTML = `<div class="success">âœ… å¤´åƒåŠ è½½æˆåŠŸï¼æ‰€æœ‰10ä¸ªæµ‹è¯•å¤´åƒéƒ½æ­£å¸¸æ˜¾ç¤ºã€‚</div>`;
          } else {
            statusDiv.innerHTML = `<div class="error">âŒ å¤´åƒåŠ è½½å¤±è´¥ï¼${errorCount}ä¸ªå¤´åƒæ— æ³•åŠ è½½ã€‚å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–CORSé™åˆ¶ã€‚</div>`;
          }
        }
      }
    }

    // 2. æµ‹è¯•MockData
    function testMockData() {
      const statusDiv = document.getElementById('mockDataStatus');
      const detailsDiv = document.getElementById('mockDataDetails');
      
      if (typeof MockData === 'undefined') {
        statusDiv.innerHTML = `<div class="error">âŒ MockDataæœªå®šä¹‰ï¼mock-data.jså¯èƒ½æ²¡æœ‰æ­£ç¡®åŠ è½½ã€‚</div>`;
        return;
      }
      
      statusDiv.innerHTML = `<div class="success">âœ… MockDataå·²åŠ è½½ï¼</div>`;
      
      detailsDiv.innerHTML = `
        <div class="data-item">
          <strong>ğŸ“Š æ•°æ®ç»Ÿè®¡ï¼š</strong><br>
          - ç”¨æˆ·æ•°ï¼š${MockData.users?.length || 0}<br>
          - ç§Ÿæˆ·æ•°ï¼š${MockData.tenants?.length || 0}<br>
          - æ™ºèƒ½ä½“æ•°ï¼š${MockData.assets?.bots?.length || 0}<br>
          - å·¥ä½œæµæ•°ï¼š${MockData.assets?.workflows?.length || 0}<br>
          - å·¥å…·æ•°ï¼š${MockData.assets?.tools?.length || 0}<br>
          - çŸ¥è¯†åº“æ•°ï¼š${MockData.assets?.knowledgeBases?.length || 0}<br>
          - æ¶ˆè´¹è®°å½•æ•°ï¼š${MockData.consumptions?.length || 0}
        </div>
      `;
    }

    // 3. æµ‹è¯•ç”¨æˆ·æ•°æ®
    function testUserData() {
      const statusDiv = document.getElementById('userDataStatus');
      const detailsDiv = document.getElementById('userDataDetails');
      
      if (!MockData.users || MockData.users.length === 0) {
        statusDiv.innerHTML = `<div class="error">âŒ æ²¡æœ‰ç”¨æˆ·æ•°æ®ï¼</div>`;
        return;
      }
      
      statusDiv.innerHTML = `<div class="success">âœ… ç”¨æˆ·æ•°æ®æ­£å¸¸ï¼å…±${MockData.users.length}ä¸ªç”¨æˆ·ã€‚</div>`;
      
      const first3Users = MockData.users.slice(0, 3);
      let html = '<h3>å‰3ä¸ªç”¨æˆ·ï¼š</h3>';
      
      first3Users.forEach(user => {
        html += `
          <div class="data-item">
            <strong>ID:</strong> ${user.id}<br>
            <strong>å§“å:</strong> ${user.name}<br>
            <strong>å¤´åƒ:</strong> ${user.avatar}<br>
            <strong>çŠ¶æ€:</strong> ${user.status}<br>
            <strong>ç§Ÿæˆ·æ•°:</strong> ${user.tenants?.length || 0}
          </div>
        `;
      });
      
      detailsDiv.innerHTML = html;
    }

    // 4. æµ‹è¯•æ¶ˆè´¹è®°å½•
    function testConsumptions() {
      const statusDiv = document.getElementById('consumptionStatus');
      const detailsDiv = document.getElementById('consumptionDetails');
      
      if (!MockData.consumptions || MockData.consumptions.length === 0) {
        statusDiv.innerHTML = `<div class="error">âŒ æ²¡æœ‰æ¶ˆè´¹è®°å½•æ•°æ®ï¼</div>`;
        return;
      }
      
      statusDiv.innerHTML = `<div class="success">âœ… æ¶ˆè´¹è®°å½•æ•°æ®æ­£å¸¸ï¼å…±${MockData.consumptions.length}æ¡è®°å½•ã€‚</div>`;
      
      // ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„æ¶ˆè´¹è®°å½•æ•°
      const userConsumptionCount = {};
      MockData.consumptions.forEach(c => {
        userConsumptionCount[c.userId] = (userConsumptionCount[c.userId] || 0) + 1;
      });
      
      const first5Users = Object.entries(userConsumptionCount).slice(0, 5);
      
      let html = '<h3>å‰5ä¸ªç”¨æˆ·çš„æ¶ˆè´¹è®°å½•æ•°ï¼š</h3>';
      first5Users.forEach(([userId, count]) => {
        const user = MockData.users.find(u => u.id === userId);
        html += `
          <div class="data-item">
            <strong>ç”¨æˆ·ID:</strong> ${userId}<br>
            <strong>ç”¨æˆ·å:</strong> ${user?.name || 'æœªæ‰¾åˆ°'}<br>
            <strong>è®°å½•æ•°:</strong> ${count}
          </div>
        `;
      });
      
      detailsDiv.innerHTML = html;
      
      // æ˜¾ç¤ºç¬¬ä¸€æ¡æ¶ˆè´¹è®°å½•
      const firstRecord = MockData.consumptions[0];
      html += `
        <h3>ç¬¬ä¸€æ¡æ¶ˆè´¹è®°å½•ç¤ºä¾‹ï¼š</h3>
        <pre>${JSON.stringify(firstRecord, null, 2)}</pre>
      `;
      
      detailsDiv.innerHTML = html;
    }

    // 5. æ˜¾ç¤ºç¬¬ä¸€ä¸ªç”¨æˆ·çš„å®Œæ•´ä¿¡æ¯
    function showFirstUser() {
      const detailsDiv = document.getElementById('firstUserDetails');
      
      if (!MockData.users || MockData.users.length === 0) {
        detailsDiv.innerHTML = `<div class="error">âŒ æ²¡æœ‰ç”¨æˆ·æ•°æ®ï¼</div>`;
        return;
      }
      
      const firstUser = MockData.users[0];
      const userConsumptions = MockData.consumptions.filter(c => c.userId === firstUser.id);
      const userBots = MockData.assets.bots.filter(b => b.userId === firstUser.id);
      const userWorkflows = MockData.assets.workflows.filter(w => w.userId === firstUser.id);
      
      detailsDiv.innerHTML = `
        <h3>ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼š</h3>
        <pre>${JSON.stringify(firstUser, null, 2)}</pre>
        
        <h3>è¯¥ç”¨æˆ·çš„èµ„äº§ï¼š</h3>
        <div class="data-item">
          - æ™ºèƒ½ä½“æ•°ï¼š${userBots.length}<br>
          - å·¥ä½œæµæ•°ï¼š${userWorkflows.length}
        </div>
        
        <h3>è¯¥ç”¨æˆ·çš„æ¶ˆè´¹è®°å½•ï¼š</h3>
        <div class="data-item">
          - æ¶ˆè´¹è®°å½•æ•°ï¼š${userConsumptions.length}
        </div>
        
        ${userConsumptions.length > 0 ? `
          <h3>ç¬¬ä¸€æ¡æ¶ˆè´¹è®°å½•ï¼š</h3>
          <pre>${JSON.stringify(userConsumptions[0], null, 2)}</pre>
        ` : '<div class="error">è¯¥ç”¨æˆ·æ²¡æœ‰æ¶ˆè´¹è®°å½•ï¼</div>'}
      `;
    }

    // æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
    window.onload = () => {
      console.log('å¼€å§‹æµ‹è¯•...');
      testAvatars();
      testMockData();
      testUserData();
      testConsumptions();
      showFirstUser();
    };
  </script>
</body>
</html>

