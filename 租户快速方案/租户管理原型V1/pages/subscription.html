<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è®¢é˜…ä¸é…é¢</title>
  
  <!-- Element Plus CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-plus@2.4.4/dist/index.css">
  
  <!-- é£ä¹¦è®¾è®¡ç³»ç»Ÿ -->
  <link rel="stylesheet" href="../assets/css/feishu-design.css">
  
  <style>
    body {
      margin: 0;
      padding: var(--spacing-6);
      background: var(--bg-2);
    }
    
    /* è®¢é˜…ä¿¡æ¯å¡ç‰‡ */
    .subscription-card {
      background: var(--bg-1);
      border-radius: var(--radius-large);
      box-shadow: var(--shadow-1);
      margin-bottom: var(--spacing-6);
      overflow: hidden;
    }
    
    .subscription-content {
      padding: var(--spacing-6);
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: var(--spacing-8);
      align-items: center;
    }
    
    .sub-item {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-3);
    }
    
    .sub-label {
      font-size: var(--font-size-13);
      color: var(--text-3);
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }
    
    .sub-value {
      font-size: var(--font-size-20);
      font-weight: var(--font-weight-semibold);
      color: var(--text-1);
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }
    
    .plan-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-2);
      padding: var(--spacing-2) var(--spacing-3);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: var(--radius-medium);
      font-size: var(--font-size-14);
      font-weight: var(--font-weight-semibold);
    }
    
    .credits-value {
      color: var(--primary-color);
      font-size: var(--font-size-28);
    }
    
    .link-button {
      color: var(--primary-color);
      cursor: pointer;
      font-size: var(--font-size-13);
      transition: opacity var(--duration-fast);
    }
    
    .link-button:hover {
      opacity: 0.8;
      text-decoration: underline;
    }
    
    .subscription-actions {
      padding: var(--spacing-4) var(--spacing-6);
      border-top: 1px solid var(--border-2);
      background: var(--fill-1);
      display: flex;
      gap: var(--spacing-3);
    }
    
    /* é…é¢åŒºåŸŸ */
    .quota-section {
      background: var(--bg-1);
      border-radius: var(--radius-large);
      box-shadow: var(--shadow-1);
      padding: var(--spacing-6);
    }
    
    .quota-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-5);
    }
    
    .quota-title {
      font-size: var(--font-size-18);
      font-weight: var(--font-weight-semibold);
      color: var(--text-1);
    }
    
    .quota-subtitle {
      font-size: var(--font-size-13);
      color: var(--text-3);
      margin-bottom: var(--spacing-5);
    }
    
    /* é…é¢å¡ç‰‡ç½‘æ ¼ */
    .quota-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--spacing-4);
    }
    
    .quota-card {
      background: var(--fill-1);
      border: 1px solid var(--border-2);
      border-radius: var(--radius-large);
      padding: var(--spacing-5);
      transition: all var(--duration-base) var(--ease-in-out);
    }
    
    .quota-card:hover {
      border-color: var(--primary-lighter);
      box-shadow: var(--shadow-1);
    }
    
    .quota-card.exceeded {
      border-color: var(--danger-light);
      background: var(--danger-lightest);
    }
    
    .quota-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-4);
    }
    
    .quota-name {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
      font-size: var(--font-size-14);
      font-weight: var(--font-weight-medium);
      color: var(--text-1);
    }
    
    .quota-icon {
      font-size: 24px;
    }
    
    .quota-adjust-btn {
      font-size: var(--font-size-12);
      padding: var(--spacing-1) var(--spacing-2);
    }
    
    .quota-progress {
      margin-bottom: var(--spacing-3);
    }
    
    .quota-stats {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: var(--font-size-13);
    }
    
    .quota-used {
      color: var(--text-2);
    }
    
    .quota-used strong {
      color: var(--text-1);
      font-weight: var(--font-weight-semibold);
    }
    
    .quota-percentage {
      color: var(--text-3);
      font-weight: var(--font-weight-medium);
    }
    
    .quota-percentage.exceeded {
      color: var(--danger-color);
    }
    
    .quota-warning {
      margin-top: var(--spacing-2);
      font-size: var(--font-size-12);
      color: var(--danger-color);
      display: flex;
      align-items: center;
      gap: var(--spacing-1);
    }
    
    /* ä¿®æ”¹å¥—é¤å¼¹çª—æ ·å¼ */
    .plan-dialog-content {
      padding: var(--spacing-2) 0;
    }
    
    .current-plan-info {
      margin-bottom: var(--spacing-6);
    }
    
    .plan-selection {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--spacing-4);
      margin-bottom: var(--spacing-6);
    }
    
    .plan-card {
      position: relative;
      background: var(--bg-1);
      border: 2px solid var(--border-2);
      border-radius: var(--radius-large);
      padding: var(--spacing-5);
      cursor: pointer;
      transition: all var(--duration-base) var(--ease-in-out);
      overflow: hidden;
    }
    
    .plan-card:hover {
      border-color: var(--primary-lighter);
      box-shadow: var(--shadow-2);
      transform: translateY(-2px);
    }
    
    .plan-card.selected {
      border-color: var(--primary-color);
      background: var(--primary-lightest);
      box-shadow: var(--shadow-2);
    }
    
    .plan-card.recommended {
      border-color: var(--success-color);
    }
    
    .plan-badge-recommended,
    .plan-badge-current {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 2px 12px;
      border-radius: var(--radius-full);
      font-size: var(--font-size-12);
      font-weight: var(--font-weight-semibold);
    }
    
    .plan-badge-recommended {
      background: var(--success-color);
      color: white;
    }
    
    .plan-badge-current {
      background: var(--info-color);
      color: white;
    }
    
    .plan-header {
      text-align: center;
      margin-bottom: var(--spacing-4);
    }
    
    .plan-icon {
      font-size: 48px;
      margin-bottom: var(--spacing-2);
    }
    
    .plan-name {
      font-size: var(--font-size-18);
      font-weight: var(--font-weight-semibold);
      color: var(--text-1);
      margin-bottom: var(--spacing-1);
    }
    
    .plan-description {
      font-size: var(--font-size-13);
      color: var(--text-3);
    }
    
    .plan-price {
      text-align: center;
      padding: var(--spacing-4) 0;
      border-top: 1px solid var(--border-2);
      border-bottom: 1px solid var(--border-2);
      margin-bottom: var(--spacing-4);
    }
    
    .price-amount {
      font-size: var(--font-size-28);
      font-weight: var(--font-weight-bold);
      color: var(--primary-color);
    }
    
    .price-unit {
      font-size: var(--font-size-13);
      color: var(--text-3);
      margin-left: var(--spacing-1);
    }
    
    .plan-features {
      margin-bottom: var(--spacing-10);
    }
    
    .feature-section {
      margin-bottom: var(--spacing-4);
    }
    
    .feature-section:last-child {
      margin-bottom: 0;
    }
    
    .feature-section-title {
      font-size: var(--font-size-13);
      font-weight: var(--font-weight-semibold);
      color: var(--text-2);
      margin-bottom: var(--spacing-2);
    }
    
    .feature-item {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-2);
      font-size: var(--font-size-13);
      color: var(--text-2);
      margin-bottom: var(--spacing-2);
      line-height: 1.6;
    }
    
    .feature-icon {
      color: var(--success-color);
      font-size: 16px;
      flex-shrink: 0;
      margin-top: 2px;
    }
    
    .plan-select-indicator {
      position: absolute;
      bottom: var(--spacing-4);
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      color: var(--primary-color);
    }
    
    .plan-card:not(.selected) .plan-select-indicator {
      color: var(--border-3);
    }
    
    .plan-form {
      background: var(--fill-1);
      border-radius: var(--radius-large);
      padding: var(--spacing-5);
    }
    
    .dialog-footer {
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-3);
    }
  </style>
</head>
<body>
  <div id="app" v-cloak>
    <!-- å½“å‰è®¢é˜…ä¿¡æ¯ -->
    <div class="subscription-card">
      <div class="subscription-content">
        <div class="sub-item">
          <div class="sub-label">å½“å‰æ–¹æ¡ˆ</div>
          <div class="sub-value">
            <span class="plan-badge">
              <el-icon><Medal /></el-icon>
              {{ subscriptionData.currentPlan.version }}
            </span>
          </div>
        </div>
        
        <div class="sub-item">
          <div class="sub-label">åˆ°æœŸæ—¶é—´</div>
          <div class="sub-value">
            {{ subscriptionData.currentPlan.expireDate }} åˆ°æœŸ
          </div>
        </div>
        
        <div class="sub-item">
          <div class="sub-label">
            <span>å¯ç”¨ç§¯åˆ†</span>
            <!-- <span class="link-button" @click="showRecordsDialog">æŸ¥çœ‹æ“ä½œè®°å½• â†’</span> -->
          </div>
          <div class="sub-value">
            <span class="credits-value">{{ formatNumber(subscriptionData.currentPlan.credits) }}</span>
          </div>
        </div>
      </div>
      
      <div class="subscription-actions">
        <el-button @click="planDialogVisible = true">
          <el-icon><Edit /></el-icon>
          ä¿®æ”¹å¥—é¤
        </el-button>
        <el-button>
          <el-icon><CoinIcon /></el-icon>
          è°ƒæ•´ç§¯åˆ†
        </el-button>
        <!-- <el-button>
          <el-icon><Document /></el-icon>
          æŸ¥çœ‹è®¢é˜…å†å²
        </el-button> -->
      </div>
    </div>
    
    <!-- é¢åº¦ç”¨é‡æ¦‚è§ˆ -->
    <div class="quota-section">
      <div class="quota-header">
        <div>
          <div class="quota-title">é¢åº¦ç”¨é‡æ¦‚è§ˆ</div>
          <div class="quota-subtitle">æŸ¥çœ‹å„é¡¹èµ„æºçš„ä½¿ç”¨æƒ…å†µå’Œé…é¢é™åˆ¶</div>
        </div>
        <!-- <span class="link-button" @click="showRecordsDialog">æŸ¥çœ‹æ“ä½œè®°å½• â†’</span> -->
      </div>
      
      <div class="quota-grid">
        <div
          v-for="quota in subscriptionData.quotas"
          :key="quota.id"
          :class="['quota-card', quota.status === 'exceeded' ? 'exceeded' : '']"
        >
          <div class="quota-card-header">
            <div class="quota-name">
              <span class="quota-icon">{{ quota.icon }}</span>
              <span>{{ quota.name }}</span>
            </div>
            <el-button class="quota-adjust-btn" size="small" @click="handleAdjustQuota(quota)">
              è°ƒæ•´
            </el-button>
          </div>
          
          <div class="quota-progress">
            <el-progress
              :percentage="Math.min(quota.percentage, 100)"
              :color="getProgressColor(quota.percentage)"
              :show-text="false"
            />
          </div>
          
          <div class="quota-stats">
            <span class="quota-used">
              å·²ä½¿ç”¨ <strong>{{ quota.used }}</strong> / {{ quota.total }} {{ quota.unit }}
            </span>
            <span :class="['quota-percentage', quota.percentage > 100 ? 'exceeded' : '']">
              {{ quota.percentage }}%
            </span>
          </div>
          
          <div v-if="quota.warningText" class="quota-warning">
            <el-icon><WarningFilled /></el-icon>
            <span>{{ quota.warningText }}</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ä¿®æ”¹å¥—é¤å¯¹è¯æ¡† -->
    <el-dialog
      v-model="planDialogVisible"
      title="ä¿®æ”¹ç§Ÿæˆ·å¥—é¤"
      width="900px"
      :close-on-click-modal="false"
    >
      <div class="plan-dialog-content">
        <div class="current-plan-info">
          <el-alert
            type="info"
            :closable="false"
            show-icon
          >
            <template #title>
              <span>å½“å‰ç§Ÿæˆ·å¥—é¤ï¼š<strong>{{ subscriptionData.currentPlan.version }}</strong>ï¼Œåˆ°æœŸæ—¶é—´ï¼š<strong>{{ subscriptionData.currentPlan.expireDate }}</strong></span>
            </template>
          </el-alert>
        </div>
        
        <div class="plan-selection">
          <div
            v-for="plan in planOptions"
            :key="plan.id"
            :class="['plan-card', { 'selected': selectedPlan === plan.id, 'current': subscriptionData.currentPlan.version === plan.name, 'recommended': plan.recommended }]"
            @click="selectedPlan = plan.id"
          >
            <div v-if="plan.recommended" class="plan-badge-recommended">æ¨è</div>
            <div v-if="subscriptionData.currentPlan.version === plan.name" class="plan-badge-current">å½“å‰</div>
            
            <div class="plan-header">
              <div class="plan-icon">{{ plan.icon }}</div>
              <div class="plan-name">{{ plan.name }}</div>
              <div class="plan-description">{{ plan.description }}</div>
            </div>
            
            <div class="plan-price">
              <span class="price-amount">{{ plan.price }}</span>
              <span class="price-unit">{{ plan.priceUnit }}</span>
            </div>
            
            <div class="plan-features">
              <div class="feature-section">
                <div class="feature-section-title">æ ¸å¿ƒæƒç›Š</div>
                <div v-for="(feature, idx) in plan.features" :key="idx" class="feature-item">
                  <el-icon class="feature-icon"><Check /></el-icon>
                  <span>{{ feature }}</span>
                </div>
              </div>
              
              <div class="feature-section">
                <div class="feature-section-title">é…é¢</div>
                <div v-for="(quota, idx) in plan.quotas" :key="idx" class="feature-item">
                  <el-icon class="feature-icon"><Check /></el-icon>
                  <span>{{ quota }}</span>
                </div>
              </div>
            </div>
            
            <div class="plan-select-indicator">
              <el-icon v-if="selectedPlan === plan.id"><CircleCheck /></el-icon>
              <el-icon v-else><Circle /></el-icon>
            </div>
          </div>
        </div>
        
        <div class="plan-form">
          <el-form :model="planForm" label-width="100px">
            <el-form-item label="åˆ°æœŸæ—¶é—´">
              <el-date-picker
                v-model="planForm.expireDate"
                type="date"
                placeholder="é€‰æ‹©åˆ°æœŸæ—¶é—´"
                :disabled-date="disabledDate"
                style="width: 100%;"
              />
            </el-form-item>
            
            <el-form-item label="åˆå§‹ç§¯åˆ†">
              <el-input-number
                v-model="planForm.credits"
                :min="0"
                :max="1000000"
                :step="1000"
                controls-position="right"
                style="width: 200px;"
              />
              <span style="margin-left: 8px; color: var(--text-3);">ç‚¹ï¼ˆä¿®æ”¹å¥—é¤æ—¶å¯èµ é€ç§¯åˆ†ï¼‰</span>
            </el-form-item>
            
            <el-form-item label="æ“ä½œåŸå› ">
              <el-input
                v-model="planForm.reason"
                type="textarea"
                :rows="3"
                placeholder="è¯·è¾“å…¥ä¿®æ”¹å¥—é¤çš„åŸå› ï¼Œå¦‚ï¼šå®¢æˆ·ç”³è¯·å‡çº§ã€å•†åŠ¡è°ˆåˆ¤ç»“æœç­‰"
                maxlength="200"
                show-word-limit
              />
            </el-form-item>
            
            <el-form-item label="é€šçŸ¥ç§Ÿæˆ·">
              <el-switch
                v-model="planForm.notifyTenant"
                active-text="å‘é€ç«™å†…ä¿¡é€šçŸ¥ç§Ÿæˆ·æ‰€æœ‰è€…"
              />
            </el-form-item>
          </el-form>
        </div>
      </div>
      
      <template #footer>
        <div class="dialog-footer">
          <el-button @click="planDialogVisible = false">å–æ¶ˆ</el-button>
          <el-button type="primary" @click="handleConfirmPlanChange" :disabled="!selectedPlan || !planForm.expireDate">
            ç¡®è®¤ä¿®æ”¹
          </el-button>
        </div>
      </template>
    </el-dialog>
    
    <!-- è°ƒæ•´é…é¢å¯¹è¯æ¡† -->
    <el-dialog
      v-model="adjustDialogVisible"
      title="è°ƒæ•´é…é¢"
      width="500px"
    >
      <el-form v-if="currentQuota" label-width="100px">
        <el-form-item label="èµ„æºç±»å‹">
          <span>{{ currentQuota.name }}</span>
        </el-form-item>
        <el-form-item label="å½“å‰é…é¢">
          <span>{{ currentQuota.total }} {{ currentQuota.unit }}</span>
        </el-form-item>
        <el-form-item label="å·²ä½¿ç”¨">
          <span>{{ currentQuota.used }} {{ currentQuota.unit }}</span>
        </el-form-item>
        <el-form-item label="æ–°é…é¢">
          <el-input-number
            v-model="newQuotaValue"
            :min="currentQuota.used"
            :max="100000"
            :step="currentQuota.id.includes('device') ? 1000 : 10"
          />
          <span style="margin-left: 8px; color: var(--text-3);">{{ currentQuota.unit }}</span>
        </el-form-item>
        <el-form-item label="è°ƒæ•´åŸå› ">
          <el-input
            v-model="adjustReason"
            type="textarea"
            :rows="3"
            placeholder="è¯·è¾“å…¥è°ƒæ•´åŸå› "
          />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="adjustDialogVisible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="handleConfirmAdjust">ç¡®è®¤è°ƒæ•´</el-button>
      </template>
    </el-dialog>
  </div>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
  <!-- Element Plus -->
  <script src="https://unpkg.com/element-plus@2.4.4/dist/index.full.js"></script>
  <!-- Element Plus Icons -->
  <script src="https://unpkg.com/@element-plus/icons-vue@2.1.0/dist/index.iife.min.js"></script>
  
  <!-- Mockæ•°æ® -->
  <script src="../assets/js/mock-data.js"></script>
  <!-- å·¥å…·å‡½æ•° -->
  <script src="../assets/js/utils.js"></script>
  
  <script>
    const { createApp, ref } = Vue;
    
    const app = createApp({
      setup() {
        // æ•°æ®
        const subscriptionData = ref(MockData.generateSubscriptionData());
        const adjustDialogVisible = ref(false);
        const currentQuota = ref(null);
        const newQuotaValue = ref(0);
        const adjustReason = ref('');
        
        // ä¿®æ”¹å¥—é¤ç›¸å…³
        const planDialogVisible = ref(false);
        const selectedPlan = ref(null);
        const planForm = ref({
          expireDate: null,
          credits: 10000,
          reason: '',
          notifyTenant: true,
        });
        
        // å¥—é¤é€‰é¡¹æ•°æ®
        const planOptions = ref([
          {
            id: 'trial',
            name: 'ä½“éªŒç‰ˆ',
            icon: 'ğŸ¯',
            description: 'é€‚åˆä¸ªäººç”¨æˆ·å’Œå°å›¢é˜Ÿä½“éªŒ',
            price: 'å…è´¹',
            priceUnit: '',
            features: [
              'åŸºç¡€AIå¯¹è¯åŠŸèƒ½',
              'æ ‡å‡†å“åº”é€Ÿåº¦',
              'ç¤¾åŒºæŠ€æœ¯æ”¯æŒ',
              'åŸºç¡€æ•°æ®åˆ†æ',
            ],
            quotas: [
              'æ™ºèƒ½ä½“: 3ä¸ª',
              'å·¥ä½œæµ: 2ä¸ª',
              'å·¥å…·åº“: 1ä¸ª',
              'å›¢é˜Ÿç©ºé—´: 1ä¸ª',
              'æˆå‘˜æ•°: 5äºº',
            ],
            recommended: false,
          },
          {
            id: 'team',
            name: 'å›¢é˜Ÿç‰ˆ',
            icon: 'ğŸ‘¥',
            description: 'é€‚åˆä¸­å°å›¢é˜Ÿåä½œä½¿ç”¨',
            price: 'Â¥2,999',
            priceUnit: '/å¹´',
            features: [
              'å®Œæ•´AIåŠŸèƒ½',
              'ä¼˜å…ˆå“åº”é€Ÿåº¦',
              'ä¸“å±å®¢æˆ·æ”¯æŒ',
              'é«˜çº§æ•°æ®åˆ†æ',
              'è‡ªå®šä¹‰å“ç‰Œ',
            ],
            quotas: [
              'æ™ºèƒ½ä½“: 10ä¸ª',
              'å·¥ä½œæµ: 10ä¸ª',
              'å·¥å…·åº“: 5ä¸ª',
              'å›¢é˜Ÿç©ºé—´: 10ä¸ª',
              'æˆå‘˜æ•°: 50äºº',
            ],
            recommended: true,
          },
          {
            id: 'enterprise',
            name: 'ä¼ä¸šç‰ˆ',
            icon: 'ğŸ¢',
            description: 'é€‚åˆå¤§å‹ä¼ä¸šå’Œç»„ç»‡',
            price: 'Â¥29,999',
            priceUnit: '/å¹´',
            features: [
              'ä¼ä¸šçº§AIåŠŸèƒ½',
              'æœ€é«˜å“åº”ä¼˜å…ˆçº§',
              '7Ã—24ä¸“å±æœåŠ¡',
              'ä¼ä¸šçº§æ•°æ®åˆ†æ',
              'å®šåˆ¶åŒ–å¼€å‘',
              'SSOå•ç‚¹ç™»å½•',
              'æ•°æ®ç§æœ‰åŒ–éƒ¨ç½²',
            ],
            quotas: [
              'æ™ºèƒ½ä½“: æ— é™',
              'å·¥ä½œæµ: æ— é™',
              'å·¥å…·åº“: æ— é™',
              'å›¢é˜Ÿç©ºé—´: æ— é™',
              'æˆå‘˜æ•°: æ— é™',
            ],
            recommended: false,
          },
        ]);
        
        // æ–¹æ³•
        const formatNumber = (num) => Utils.formatNumber(num);
        
        const getProgressColor = (percentage) => {
          if (percentage >= 100) return '#F53F3F';
          if (percentage >= 80) return '#FF7D00';
          return '#3370FF';
        };
        
        const showRecordsDialog = () => {
          Utils.showInfo('æŸ¥çœ‹æ“ä½œè®°å½•åŠŸèƒ½ï¼ˆæ¼”ç¤ºï¼‰');
        };
        
        const handleAdjustQuota = (quota) => {
          currentQuota.value = quota;
          newQuotaValue.value = quota.total;
          adjustReason.value = '';
          adjustDialogVisible.value = true;
        };
        
        const handleConfirmAdjust = () => {
          if (!adjustReason.value) {
            Utils.showWarning('è¯·è¾“å…¥è°ƒæ•´åŸå› ');
            return;
          }
          
          // æ›´æ–°é…é¢
          currentQuota.value.total = newQuotaValue.value;
          currentQuota.value.percentage = Math.floor((currentQuota.value.used / currentQuota.value.total) * 100);
          
          if (currentQuota.value.percentage > 100) {
            currentQuota.value.status = 'exceeded';
            currentQuota.value.warningText = 'ç”¨é‡å·²è¶…é¢ï¼Œè¯·è°ƒæ•´é…é¢';
          } else {
            currentQuota.value.status = 'normal';
            currentQuota.value.warningText = '';
          }
          
          adjustDialogVisible.value = false;
          Utils.showSuccess('é…é¢è°ƒæ•´æˆåŠŸ');
        };
        
        // ä¿®æ”¹å¥—é¤ç›¸å…³æ–¹æ³•
        const disabledDate = (time) => {
          // ç¦ç”¨ä»Šå¤©ä¹‹å‰çš„æ—¥æœŸ
          return time.getTime() < Date.now() - 24 * 60 * 60 * 1000;
        };
        
        const handleConfirmPlanChange = async () => {
          if (!selectedPlan.value) {
            Utils.showWarning('è¯·é€‰æ‹©å¥—é¤ç±»å‹');
            return;
          }
          
          if (!planForm.value.expireDate) {
            Utils.showWarning('è¯·é€‰æ‹©åˆ°æœŸæ—¶é—´');
            return;
          }
          
          if (!planForm.value.reason) {
            Utils.showWarning('è¯·è¾“å…¥æ“ä½œåŸå› ');
            return;
          }
          
          const selectedPlanData = planOptions.value.find(p => p.id === selectedPlan.value);
          
          const confirmed = await Utils.confirmAction(
            `ç¡®è®¤å°†ç§Ÿæˆ·å¥—é¤ä¿®æ”¹ä¸º"${selectedPlanData.name}"å—ï¼Ÿ<br>åˆ°æœŸæ—¶é—´ï¼š${Utils.formatDate(planForm.value.expireDate)}<br>åˆå§‹ç§¯åˆ†ï¼š${planForm.value.credits} ç‚¹`,
            'ç¡®è®¤ä¿®æ”¹å¥—é¤'
          );
          
          if (!confirmed) return;
          
          // æ›´æ–°è®¢é˜…æ•°æ®
          subscriptionData.value.currentPlan.version = selectedPlanData.name;
          subscriptionData.value.currentPlan.expireDate = Utils.formatDate(planForm.value.expireDate);
          subscriptionData.value.currentPlan.credits = planForm.value.credits;
          
          // å…³é—­å¼¹çª—
          planDialogVisible.value = false;
          
          // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
          let message = `å¥—é¤å·²ä¿®æ”¹ä¸º"${selectedPlanData.name}"`;
          if (planForm.value.notifyTenant) {
            message += 'ï¼Œå·²å‘é€é€šçŸ¥ç»™ç§Ÿæˆ·æ‰€æœ‰è€…';
          }
          Utils.showSuccess(message);
          
          // é‡ç½®è¡¨å•
          selectedPlan.value = null;
          planForm.value = {
            expireDate: null,
            credits: 10000,
            reason: '',
            notifyTenant: true,
          };
        };
        
        return {
          subscriptionData,
          adjustDialogVisible,
          currentQuota,
          newQuotaValue,
          adjustReason,
          planDialogVisible,
          selectedPlan,
          planForm,
          planOptions,
          formatNumber,
          getProgressColor,
          showRecordsDialog,
          handleAdjustQuota,
          handleConfirmAdjust,
          disabledDate,
          handleConfirmPlanChange,
        };
      },
    });
    
    // æ³¨å†Œå›¾æ ‡
    for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
      app.component(key, component);
    }
    
    // æ‰‹åŠ¨æ³¨å†Œ Coin å›¾æ ‡ï¼ˆElement Plus æ²¡æœ‰è¿™ä¸ªå›¾æ ‡ï¼Œç”¨ Money ä»£æ›¿ï¼‰
    app.component('CoinIcon', ElementPlusIconsVue.Money);
    
    app.use(ElementPlus);
    app.mount('#app');
  </script>
</body>
</html>

