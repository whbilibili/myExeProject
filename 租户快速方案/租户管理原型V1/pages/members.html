<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆå‘˜ä¸éƒ¨é—¨</title>
  
  <!-- Element Plus CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-plus@2.4.4/dist/index.css">
  
  <!-- é£ä¹¦è®¾è®¡ç³»ç»Ÿ -->
  <link rel="stylesheet" href="../assets/css/feishu-design.css">
  
  <style>
    body {
      margin: 0;
      padding: 0;
      background: var(--bg-2);
    }
    
    /* Tabsé¡¶éƒ¨åŒºåŸŸ */
    .tabs-header {
      background: var(--bg-1);
      padding: var(--spacing-4) var(--spacing-6);
      border-bottom: 1px solid var(--border-2);
    }
    
    /* ç»„ç»‡æˆå‘˜é¡µé¢å¸ƒå±€ */
    .org-layout {
      display: flex;
      height: calc(100vh - 120px);
      background: var(--bg-2);
    }
    
    /* å·¦ä¾§ç»„ç»‡æ ‘ */
    .org-tree-container {
      width: 280px;
      background: var(--bg-1);
      border-right: 1px solid var(--border-2);
      overflow-y: auto;
      flex-shrink: 0;
    }
    
    .tree-header {
      padding: var(--spacing-5);
      border-bottom: 1px solid var(--border-2);
      font-weight: var(--font-weight-semibold);
      color: var(--text-1);
    }
    
    .tree-content {
      padding: var(--spacing-4);
    }
    
    /* å³ä¾§æˆå‘˜åˆ—è¡¨ */
    .members-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding: var(--spacing-6);
    }
    
    .members-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-4);
      gap: var(--spacing-4);
    }
    
    .toolbar-left {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      flex: 1;
    }
    
    .toolbar-right {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }
    
    /* æˆå‘˜è¡¨æ ¼å®¹å™¨ */
    .members-table-container {
      flex: 1;
      background: var(--bg-1);
      border-radius: var(--radius-large);
      box-shadow: var(--shadow-1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    /* æˆå‘˜åç§°å•å…ƒæ ¼ */
    .member-cell {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }
    
    .member-tag {
      margin-left: var(--spacing-2);
    }
    
    /* å ä½é¡µé¢ */
    .placeholder-page {
      height: calc(100vh - 120px);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-1);
    }
    
    .placeholder-content {
      text-align: center;
      color: var(--text-3);
    }
    
    .placeholder-icon {
      font-size: 64px;
      margin-bottom: var(--spacing-4);
    }
    
    .placeholder-text {
      font-size: var(--font-size-16);
    }
  </style>
</head>
<body>
  <div id="app" v-cloak>
    <!-- Tabs -->
    <div class="tabs-header">
      <el-tabs v-model="activeTab">
        <el-tab-pane label="å…¨éƒ¨æˆå‘˜" name="all" />
        <el-tab-pane label="ç»„ç»‡æˆå‘˜" name="organization" />
        <el-tab-pane label="å¤–éƒ¨åä½œè€…" name="external" />
        <el-tab-pane label="è™šæ‹Ÿè§’è‰²ç®¡ç†" name="virtual" />
      </el-tabs>
    </div>
    
    <!-- ç»„ç»‡æˆå‘˜é¡µé¢ -->
    <div v-if="activeTab === 'organization'" class="org-layout">
      <!-- å·¦ä¾§ç»„ç»‡æ ‘ -->
      <div class="org-tree-container">
        <div class="tree-header">ç»„ç»‡æ¶æ„</div>
        <div class="tree-content">
          <el-tree
            :data="orgTreeData"
            :props="treeProps"
            default-expand-all
            highlight-current
            @node-click="handleNodeClick"
          >
            <template #default="{ node, data }">
              <span style="display: flex; align-items: center; gap: 8px;">
                <el-icon><OfficeBuilding /></el-icon>
                <span>{{ node.label }}</span>
                <span style="color: var(--text-3); font-size: 12px;">({{ data.count || 0 }})</span>
              </span>
            </template>
          </el-tree>
        </div>
      </div>
      
      <!-- å³ä¾§æˆå‘˜åˆ—è¡¨ -->
      <div class="members-container">
        <!-- å·¥å…·æ  -->
        <div class="members-toolbar">
          <div class="toolbar-left">
            <el-input
              v-model="searchKeyword"
              placeholder="æœç´¢å…³é”®è¯"
              clearable
              style="width: 300px;"
            >
              <template #prefix>
                <el-icon><Search /></el-icon>
              </template>
            </el-input>
            <el-button :icon="Filter">é«˜çº§ç­›é€‰</el-button>
            <el-checkbox v-model="includeSubDepts">åŒ…å«å­éƒ¨é—¨</el-checkbox>
          </div>
          <div class="toolbar-right">
            <el-button>
              <el-icon><Upload /></el-icon>
              æ‰¹é‡å¯¼å…¥
            </el-button>
            <el-button>
              <el-icon><Message /></el-icon>
              é‚€è¯·æˆå‘˜
            </el-button>
            <el-button type="primary">
              <el-icon><Plus /></el-icon>
              æ·»åŠ æˆå‘˜
            </el-button>
          </div>
        </div>
        
        <!-- æˆå‘˜è¡¨æ ¼ -->
        <div class="members-table-container">
          <el-table
            :data="filteredMembers"
            style="width: 100%"
            height="100%"
          >
            <el-table-column type="selection" width="50" />
            
            <el-table-column label="æˆå‘˜åç§°" min-width="180" fixed>
              <template #default="{ row }">
                <div class="member-cell">
                  <img :src="row.avatar" :alt="row.name" class="avatar" />
                  <span class="user-name">{{ row.name }}</span>
                  <el-tag v-if="row.isLeader" size="small" type="primary" class="member-tag">è´Ÿè´£äºº</el-tag>
                </div>
              </template>
            </el-table-column>
            
            <el-table-column prop="department" label="å½’å±éƒ¨é—¨" min-width="160" />
            
            <el-table-column prop="phone" label="æ‰‹æœºå·" width="130">
              <template #default="{ row }">
                <span style="font-family: var(--font-family-mono); font-size: 13px;">{{ row.phone }}</span>
              </template>
            </el-table-column>
            
            <el-table-column prop="email" label="é‚®ç®±å·" min-width="180">
              <template #default="{ row }">
                <span style="font-family: var(--font-family-mono); font-size: 13px;">{{ row.email }}</span>
              </template>
            </el-table-column>
            
            <el-table-column prop="supervisor" label="ç›´å±ä¸Šçº§" width="120">
              <template #default="{ row }">
                {{ row.supervisor || '-' }}
              </template>
            </el-table-column>
            
            <el-table-column prop="role" label="æƒé™" width="120">
              <template #default="{ row }">
                <el-tag size="small" :type="getRoleType(row.role)">{{ row.role }}</el-tag>
              </template>
            </el-table-column>
            
            <el-table-column prop="joinTime" label="åŠ å…¥æ—¶é—´" width="120" />
            
            <el-table-column label="æ“ä½œ" width="100" fixed="right">
              <template #default="{ row }">
                <el-button link type="danger" size="small" @click="handleRemoveMember(row)">
                  åˆ é™¤
                </el-button>
              </template>
            </el-table-column>
          </el-table>
          
          <!-- åˆ†é¡µ -->
          <div style="padding: 16px; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--border-2);">
            <span style="color: var(--text-3); font-size: 13px;">
              å…± {{ filteredMembers.length }} æ¡
            </span>
            <el-pagination
              v-model:current-page="pagination.page"
              v-model:page-size="pagination.pageSize"
              :page-sizes="[10, 20, 50, 100]"
              :total="filteredMembers.length"
              layout="sizes, prev, pager, next, jumper"
              small
            />
          </div>
        </div>
      </div>
    </div>
    
    <!-- å…¶ä»–Tabå ä½é¡µé¢ -->
    <div v-else class="placeholder-page">
      <div class="placeholder-content">
        <div class="placeholder-icon">ğŸ“‹</div>
        <div class="placeholder-text">{{ getPlaceholderText() }}</div>
      </div>
    </div>
  </div>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
  <!-- Element Plus -->
  <script src="https://unpkg.com/element-plus@2.4.4/dist/index.full.js"></script>
  <!-- Element Plus Icons -->
  <script src="https://unpkg.com/@element-plus/icons-vue@2.1.0/dist/index.iife.min.js"></script>
  
  <!-- Mockæ•°æ® -->
  <script src="../assets/js/mock-data.js"></script>
  <!-- å·¥å…·å‡½æ•° -->
  <script src="../assets/js/utils.js"></script>
  
  <script>
    const { createApp, ref, computed } = Vue;
    
    const app = createApp({
      setup() {
        // TabçŠ¶æ€
        const activeTab = ref('organization');
        
        // ç»„ç»‡æ ‘æ•°æ®
        const orgTreeData = ref([
          {
            label: 'è´¨æ•ˆæŠ€æœ¯éƒ¨',
            count: 35,
            children: [
              { label: 'é—ªè´­æŠ€æœ¯éƒ¨', count: 8 },
              { 
                label: 'å†…è´­æµ‹è¯•ç»„', 
                count: 15,
                children: [
                  { label: 'å†…è´­ä¸šåŠ¡æµ‹è¯•ç»„', count: 5 },
                  { label: 'å†…è´­äº§å“æµ‹è¯•ç»„', count: 5 },
                  { label: 'å†…è´­å•†å®¶ç«¯æµ‹è¯•ç»„', count: 3 },
                  { label: 'å†…è´­è¥é”€æµ‹è¯•ç»„', count: 2 },
                ]
              },
              { label: 'å…¬å…±äº§å“æµ‹è¯•ç»„', count: 7 },
              { label: 'é…’åº—è´¨è¡Œæµ‹è¯•ç»„', count: 5 },
            ]
          },
          {
            label: 'æœåŠ¡é›¶å”®æµ‹è¯•ç»„',
            count: 20,
            children: [
              { label: 'ä¹ç”Ÿæ´»åŠå“è´¨äº¤æ˜“æµ‹è¯•ç»„', count: 8 },
              { label: 'æ¶ˆè´¹åŒ»ç–—åŠææ¡£æµ‹è¯•ç»„', count: 7 },
              { label: 'æ˜“ç”Ÿæ´»åŠå¢é•¿æµ‹è¯•ç»„', count: 5 },
            ]
          },
          {
            label: 'çˆ†çº¦å¹³å°æµ‹è¯•ç»„',
            count: 18,
            children: [
              { label: 'çˆ†çº¦æ–¹æ¡ˆä¸ç­–ç•¥æµ‹è¯•ç»„', count: 6 },
              { label: 'çˆ†çº¦ç»ˆç«¯æµ‹è¯•ç»„', count: 12 },
            ]
          },
        ]);
        
        const treeProps = {
          children: 'children',
          label: 'label',
        };
        
        // æˆå‘˜æ•°æ®
        const allMembers = ref(MockData.members);
        const searchKeyword = ref('');
        const includeSubDepts = ref(true);
        const selectedDept = ref(null);
        
        // åˆ†é¡µ
        const pagination = ref({
          page: 1,
          pageSize: 20,
        });
        
        // è¿‡æ»¤åçš„æˆå‘˜
        const filteredMembers = computed(() => {
          let members = [...allMembers.value];
          
          // æœç´¢
          if (searchKeyword.value) {
            const keyword = searchKeyword.value.toLowerCase();
            members = members.filter(m =>
              m.name.toLowerCase().includes(keyword) ||
              m.phone.includes(keyword) ||
              m.email.toLowerCase().includes(keyword) ||
              m.department.toLowerCase().includes(keyword)
            );
          }
          
          return members;
        });
        
        // æ–¹æ³•
        const handleNodeClick = (data) => {
          selectedDept.value = data.label;
          // è¿™é‡Œå¯ä»¥æ ¹æ®é€‰ä¸­çš„éƒ¨é—¨ç­›é€‰æˆå‘˜
        };
        
        const getRoleType = (role) => {
          const roleMap = {
            'æ‰€æœ‰è€…': 'danger',
            'ç®¡ç†å‘˜': 'warning',
            'ç©ºé—´åˆ›å»ºå‘˜': 'success',
            'æˆå‘˜': 'info',
          };
          return roleMap[role] || 'info';
        };
        
        const handleRemoveMember = async (row) => {
          const confirmed = await Utils.confirmAction(
            `ç¡®å®šè¦åˆ é™¤æˆå‘˜"${row.name}"å—ï¼Ÿ`,
            'åˆ é™¤æˆå‘˜'
          );
          
          if (confirmed) {
            const index = allMembers.value.findIndex(m => m.id === row.id);
            if (index > -1) {
              allMembers.value.splice(index, 1);
              Utils.showSuccess('æˆå‘˜å·²åˆ é™¤');
            }
          }
        };
        
        const getPlaceholderText = () => {
          const textMap = {
            'all': 'å…¨éƒ¨æˆå‘˜é¡µé¢ï¼ˆæ¼”ç¤ºå ä½ï¼‰',
            'external': 'å¤–éƒ¨åä½œè€…é¡µé¢ï¼ˆæ¼”ç¤ºå ä½ï¼‰',
            'virtual': 'è™šæ‹Ÿè§’è‰²ç®¡ç†é¡µé¢ï¼ˆæ¼”ç¤ºå ä½ï¼‰',
          };
          return textMap[activeTab.value] || '';
        };
        
        return {
          activeTab,
          orgTreeData,
          treeProps,
          allMembers,
          searchKeyword,
          includeSubDepts,
          selectedDept,
          pagination,
          filteredMembers,
          handleNodeClick,
          getRoleType,
          handleRemoveMember,
          getPlaceholderText,
        };
      },
    });
    
    // æ³¨å†Œå›¾æ ‡
    for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
      app.component(key, component);
    }
    
    app.use(ElementPlus);
    app.mount('#app');
  </script>
</body>
</html>

