# PRD: 租户功能权限管理模块 V1.0

| **文档状态** | 草稿 | **负责人** | [您的名字] |
| :--- | :--- | :--- | :--- |
| **创建日期** | [创建日期] | **最后更新** | [更新日期] |
| **目标版本** | V1.0 (MVP) | **关联文档** | [原始方案链接] |

---

## 1. 背景与目标

### 1.1 背景 (Why)
当前平台已有一套基于"空间"的**数据权限**体系，但缺少一套独立的**功能权限**体系。这导致我们无法对平台上的某些高级功能（如AI报告、创建空间、高级API调用等）进行精细化的授权管理，既限制了企业租户内部的管理灵活性，也阻碍了产品未来的商业化进程。

### 1.2 核心理念
我们将在现有体系之上，引入一套全新的、更高维度的功能权限体系，实现"**功能权限**"与"**数据权限**"的彻底分离。
*   **功能权限 (管能力)**: 决定用户**有没有资格**使用某个产品功能。
*   **数据权限 (管资源)**: 决定用户能对**哪个具体数据**做什么操作。

### 1.3 目标 (What)
*   **产品目标**: 为租户管理员提供一个直观、高效的界面，用于管理其租户内成员对各项高级功能的使用资格。
*   **用户目标**: 租户管理员可以根据团队成员的实际职责，精确地分配功能权限，实现最小权限原则。
*   **商业目标**: 为产品未来的按功能付费、版本升降级等商业化策略奠定坚实的技术基础。

### 1.4 范围界定 (Scope)
*   **本期包含**: 本文档主要定义通用的"**功能权限**"管理模块的设计。
*   **本期不包含**: 特殊的、结构性的管理权限，如"**创建空间**"。此类权限将被定义为一种独立的【管理角色】（例如"空间创建者"），并在"企业设置"的其他模块（如"企业概览"或未来的"角色管理"）中进行配置，以保证高风险权限的隔离与职责清晰。

## 2. 版本规划 (Roadmap)

### V1.0 (MVP) - 本期范围
*   在"企业设置"中新增"**功能与授权**"Tab。
*   实现以"功能"为维度的列表展示。
*   实现**按指定成员 (By Member)** 进行授权的核心配置流程。

### V2.0 (未来规划)
*   增加**按部门/角色 (By Department/Role)** 的批量授权能力。
*   增加**全体成员 (All Members)** 一键授权/关闭功能。
*   在前端非核心区域植入"联系管理员开通"等升级引导。

## 3. 用户故事 (User Stories)

*   **As a 租户管理员,** 我希望有一个集中的地方可以管理团队成员对各项高级功能的使用权限，**So that** 我可以确保只有被授权的人才能使用这些功能，避免资源滥用和管理混乱。
*   **As a 租户管理员,** 我希望能按人搜索并添加/移除某个功能的权限，**So that** 我可以灵活地为新员工开通权限，或为离职/转岗员工回收权限。
*   **As an 普通用户,** 我希望我的操作界面是简洁的，只显示我能使用的功能，**So that** 我不会被我没有权限的功能所干扰。

## 4. 功能详述 (Functional Specification)

### 4.1 入口
在企业租户的"**企业设置**"页面中，在"成员与部门管理"、"企业账号权益"等Tab旁边，新增一个Tab，命名为"**功能与授权**"。
*   **权限**: 此Tab仅对该租户的**租户管理员**可见并可操作。

### 4.2 主界面：功能列表
进入"功能与授权"Tab后，页面主体为一个功能列表，展示平台所有可被配置的功能。

| 功能名称 | 描述 | 授权范围 | 操作 |
| :--- | :--- | :--- | :--- |
| **AI批量分析报告** | 允许用户使用AI能力，批量生成数据分析报告。 | 未配置 | `配置权限` |
| **高级API访问** | 允许用户生成API Key，通过编程方式访问平台数据。 | 已授权 1 个成员 | `配置权限` |
| **SSO单点登录配置**| 允许管理员配置企业级的SSO单点登录。|未配置|`配置权限`|

**列表字段说明:**
*   **功能名称**: 功能的官方名称，简明扼要。
*   **描述**: 一句话解释这个功能的作用和价值。
*   **授权范围**:
    *   若无人被授权，显示"未配置"。
    *   若有人被授权，显示"已授权 N 个成员"。（N为具体数字）
*   **操作**: 一个"配置权限"按钮，点击后进入配置流程。

### 4.3 核心流程：配置权限 (V1.0)
点击任一功能行右侧的"**配置权限**"按钮，弹出一个模态框 (Modal)。

**模态框设计:**
*   **标题**: `配置权限 - [功能名称]`，例如："配置权限 - AI批量分析报告"。
*   **内容区**:
    1.  **成员搜索框**:
        *   **占位符 (Placeholder)**: "按姓名/邮箱/MIS号搜索成员"。
        *   **交互**: 支持实时模糊搜索，下拉列表展示匹配的成员。
        *   **数据源**: 租户内"全部成员"列表。
    2.  **已授权成员列表**:
        *   **展示**: 纵向列表，每行展示一个已获得该功能权限的成员。
        *   **成员信息**: 头像、姓名。
        *   **操作**: 每行右侧有一个"**移除**"按钮。
        *   **空状态**: 当列表为空时，显示文案："暂无成员获得此权限，请从上方搜索框添加。"
    3.  **操作按钮**: 模态框右下角有一个"**完成**"按钮，点击后关闭弹窗。

**流程描述:**
1.  管理员在搜索框输入并选中一个成员。
2.  该成员被自动添加到下方的"已授权成员列表"中。
3.  管理员可在列表中"移除"已添加的成员。
4.  所有添加/移除操作**即时生效**，无需额外点击保存按钮。
5.  管理员配置完成后，点击"完成"关闭模态框。主界面的"授权范围"列同步更新授权人数。

### 4.4 前端用户体验
*   **动态UI适配 (无感知授权)**:
    *   对于最终用户，其操作界面将根据其拥有的功能权限动态渲染。
    *   **规则**: 如果用户**没有**某个功能的权限，则前端不应渲染该功能的入口按钮或菜单项。

### 4.5 平台后端配置
*   需提供一个平台级的**全局功能清单**管理机制（如后台管理界面或配置文件）。
*   平台管理员可以在此清单中定义新功能，包括其`feature_key` (如 `CAN_USE_AI_REPORT`)、`名称`和`描述`。
*   租户端的"功能与授权"列表，动态拉取并展示此清单中的内容。

## 5. 非功能性需求
*   **权限控制**: 严格校验操作者是否为租户管理员，防止越权操作。
*   **性能**: 成员搜索响应速度应在500ms以内。
*   **数据一致性**: 权限配置需实时生效，并确保多端（Web, Desktop等）体验一致。

## 6. 数据埋点与成功指标
*   **数据埋点**:
    *   "功能与授权"Tab的点击次数 (PV/UV)。
    *   每个功能的"配置权限"按钮点击次数。
    *   每次成功添加/移除成员的事件。
*   **成功指标**:
    *   **功能使用率**: X%的活跃租户使用了该功能进行权限配置。
    *   **管理效率**: （若可衡量）因权限问题产生的支持工单数量下降。

## 7. 待讨论事项
*   V1.0阶段，需要纳入"功能清单"的首个具体功能是什么？（建议初步纳入"AI批量分析报告"或"高级API访问"，以验证核心流程）。
*   "配置权限"模态框的具体UI/UX设计细节，需设计同学介入。
