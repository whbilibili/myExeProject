【数据库与向量库】官方指令 - 删除记录(支持筛选) - V1.0.0

指令名称

DeleteRecord / 删除记录

功能描述

从指定的数据表（由 base_id 和 table_id 标识）中，删除一条或多条指定的记录（行）。

使用说明

在工作流画布中添加"删除记录"节点。

配置节点的输入参数，需要提供：

所属数据库 Base ID (base_id) (必填): 目标数据表所在的 ABS 数据库的 ID。

目标数据表 Table ID (table_id) (必填): 要删除记录的数据表的 ID。通常来源于"连接数据表"节点的输出。

过滤条件 (filter_by_formula): 提供一个 ABS 公式字符串来筛选需要删除的记录。

将节点的输入连接到前序节点（获取 base_id, table_id）。

执行工作流。

检查节点的输出，确认记录是否成功删除。

注意事项

权限: 执行此操作需要在目标 ABS 数据表上拥有删除记录的权限。系统传递的 token 必须具有此权限。

不可逆操作: 删除记录通常是不可恢复的。请务必谨慎操作，或确保有备份/恢复机制。

记录必须存在: 只有当筛选的对应的记录存在时，删除才会成功。尝试删除不存在的记录可能会被忽略或报告为错误。

批量删除: 当一次性删除多条记录时，平台可能对单次请求的记录数量有限制。部分记录成功删除、部分失败（如记录不存在或无权限）的情况需要考虑（事务性或逐条尝试）。

适用场景

根据业务逻辑或用户操作，清理不再需要的数据记录（例如：删除已完成的任务、移除过期的日志）。

在数据迁移或同步过程中，删除目标表中已作废的记录。

用户执行删除操作后，通过工作流在后端执行实际的数据删除。

入参

参数名

参数说明

是否必填

用户是否配置

base_id

所属 ABS 数据库的 Base ID

是

是

table_id

目标 ABS 数据表的 Table ID

是

是

filter_by_formula

(可选) 用于筛选记录的 ABS 公式字符串。

格式：(字段名,逻辑符,字段值)；举例："(名字,eq,李四)"

逻辑符语法：等于(eq)，不等于(neq)，大于(gt)，大于等于(gte)，小于(lt)，小于等于(lte)，模糊匹配/不匹配（like/nlike），为空(blank)，不为空(notblank)

多个筛选条件用~or(或),~and(与)连接，举例："(名字,eq,李四)~or(名字,eq,张三)"

是

是

token

ABS 调用令牌

是

否 (系统获取)

请求体示例 (删除多条记录):

{
  "base_id": "p93bg0202ip3z0q",
  "table_id": "mh1spz0v27b4isk",
  "filter_by_formula": "(数字,eq,3)~or(数字,eq,4)",   // 筛选字段【数字】等于3或者字段【数字】等于4的所有记录
}


出参

参数名

参数说明

code

状态码

msg

操作结果的总体消息。

data

删除成功的记录ID列表，以及成功删除的记录数

响应体示例 (全部成功):

{
  "msg": "删除成功",
  "code": 200,
  "data": {
    "pkIds": [
      3,
      5
    ],
    "deleted_count": 2
  }
}

XML 语法

<!-- XML 调用格式，待开发同学提供 -->
<!-- 示例结构 -->
<DeleteRecord baseId="{{base_id}}" tableId="{{table_id}}">
  <RecordIds>
    <Id>{{record_id_1}}</Id>
    <Id>rec_def222</Id>
  </RecordIds>
  <!-- 系统会自动填充 token 和 workspaceID -->
</DeleteRecord>


Groovy 语法

// Groovy 调用格式，待开发同学提供
// 示例结构
def idsToDelete = workflow.getVariable('records_to_cleanup') // Assume this is a list of record IDs

if (idsToDelete && !idsToDelete.isEmpty()) {
  def deleteResult = engine.execute('DeleteRecord', [
    base_id: workflow.getVariable('target_base_id'),
    table_id: workflow.getVariable('target_table_id'),
    record_ids: idsToDelete
  ])

  if (deleteResult.success) {
    println("Successfully deleted ${deleteResult.output.deleted_count} records.")
  } else {
    println("Failed to delete records: " + deleteResult.error.message)
    if (deleteResult.output.errors) {
       deleteResult.output.errors.each { err -> println(" - Record ${err.record_id}: ${err.message}") }
    }
  }
} else {
  println("No records specified for deletion.")
}


使用案例

任务完成归档: 当工作流中的某个任务标记为"已完成"超过 30 天后，触发一个清理流程。使用"获取记录"找到这些过期完成的任务记录 ID，然后调用"删除记录"指令，传入这些 ID 将其从主任务表中移除（或者先将其移动到归档表再删除）。

分类与标签

数据库, Database, 数据表, Table, ABS, 删除, Delete, Remove, Record, Data Management, CRUD (Delete)

错误码与异常说明

错误码

说明

处理建议

400

未知错误

查看工作流执行日志，联系平台管理员。

Http状态码：401

身份验证失败

检查系统配置的 ABS Token 是否有效或已过期。

403

权限不足

确认执行工作流的凭证（Token）具有删除目标 ABS 数据表记录的权限。

404

节点不存在

确认传入的 base_id是否正确，以及凭证是否有权访问该数据库 (Base)。

权限与安全要求 (permission)

需要登录: 是。

涉及敏感操作: 是。删除数据是不可逆的高风险操作。

具体权限: 需要对目标 ABS 数据表拥有删除权限 (具体权限名称依 ABS 平台定义)。

数据安全: 无数据传输安全问题，但操作后果严重。

依赖关系与前置条件 (dependencies/prerequisites)

目标 ABS 数据库 (Base) 和数据表: 必须存在，且可通过 base_id 和 table_id 访问。

有效凭证: 系统必须能够获取到有效的、具有删除目标表记录权限的 ABS Token。

有效记录: 必须提供一个或多个有效的筛选条件。