【数据库与向量库】官方指令 - 编辑指定记录(指定记录ID) - V1.0.0

指令名称

UpdateRecord / 编辑记录

功能描述

根据提供的更新指令列表，更新指定的 ABS 数据表（由 base_id 和 table_id 标识）中对应一条或多条记录的一个或多个字段的值，并返回成功更新记录的完整信息。

使用说明

在工作流画布中添加"编辑记录"节点。

配置节点的输入参数，需要提供：

所属数据库 Base ID (base_id) (必填): 目标数据表所在的 ABS 数据库的 ID。

目标数据表 Table ID (table_id) (必填): 要编辑记录的数据表的 ID。

更新列表 (updates) (必填): 一个包含一个或多个更新指令对象的 JSON 数组。每个对象必须包含：

id: 要编辑的记录的唯一 ID。即ABS中，每条记录的系统字段：id

包含要更新的字段名和新值。例如：{"状态": "已完成", "完成时间": "2024-08-01"}。

将节点的输入连接到前序节点（获取 base_id, table_id, updates 列表等）。

执行工作流。

检查节点的输出，确认记录是否成功更新，并可获取更新后记录的完整信息。

注意事项

权限: 执行此操作需要在目标 ABS 数据表上拥有编辑/写入记录的权限。系统传递的 token 必须具有此权限。

记录必须存在: updates 数组中每个对象提供的 record_id 必须对应目标表中存在的记录。尝试更新不存在的记录会导致该条记录更新失败。

字段必须存在: updates 数组中每个对象提供的字段名或 ID 必须在目标表中存在。尝试更新不存在的字段可能会被忽略或导致错误。

部分更新: 每个 updates 数组中每个对象只需提供需要修改的字段及其新值即可，未提供的字段将保持不变。

原子性: 批量更新通常不是原子操作。部分记录成功、部分失败是常见情况，需检查 errors 输出。

性能考量: 此指令始终返回成功更新记录的完整信息。这简化了下游处理，但在仅需确认成功的场景下，可能会比仅返回成功状态的方案有略高的性能开销。

适用场景

根据用户操作或工作流逻辑，批量修改多条数据记录的状态，并可能需要立即使用更新后的完整数据。

修正之前录入错误的多条数据。

将从其他系统获取的最新信息同步更新到 ABS 数据表中对应的多条记录。

处理批量编辑请求。

入参

参数名

参数说明

是否必填

用户是否配置

base_id

所属 ABS 数据库的 Base ID

是

是

table_id

目标 ABS 数据表的 Table ID

是

是

updates

包含一个或多个更新指令对象的 JSON 数组。每个对象必须包含记录ID，结构为： 

{ "id": "...", "字段名": "新值"}。例： 

[ { "id": "rec_abc","状态": "完成"}, { "id": "rec_def","优先级": "高"} ]

记录ID的获取方式

1）前序节点的输出，返回的记录数据中包含：Id字段。如：

{
  "最后更新时间": "2025-05-07 10:52:10",
   "创建时间": "2025-04-29 20:39:18",
   "Id": 7,
   "字段6": "更新一个数据"
}

2）登录ABS，选择目标表，点击【字段设置】，选择【显示所有系统字段】，系统字段：Id，即为所有记录的唯一Id

是

是

token

ABS 调用令牌

是

否 (系统获取)

请求体示例 (更新单条记录):

{
  "base_id": "p93bg0202ip3z0q",
  "table_id": "mh1spz0v27b4isk",
  "updates": [
    {
      "Id": 1,
      "状态": "进行中",
      "优先级": "中"
    }
  ]
}


请求体示例 (更新多条记录):

{
  "base_id": "p93bg0202ip3z0q",
  "table_id": "mh1spz0v27b4isk",
  "updates": [
    { "Id": 3, "状态": "已归档"  },
    { "Id": 5, "负责人": ["userC"], "截止日期": "2024-09-01"}
  ]
}


请求体示例 (批量更新，其中一条记录不存在):

{
  "base_id": "p93bg0202ip3z0q",
  "table_id": "mh1spz0v27b4isk",
  "updates": [
    { "Id": 1, "update_data": { "状态": "已完成" } },
    { "Id": 6, "update_data": { "状态": "未知" } } // 这条会失败
  ]
}


出参

参数名

参数说明

code

状态码

msg

操作结果的总体消息。

data

包括更新成功的记录详细信息列表，以及更新成功的记录数

响应体示例 (成功更新单条):

{
  "msg": "更新成功",
  "code": 200,
  "data": {
    "updated_count": 1,
    "records": [
      {
        "最后更新时间": "2025-05-07 10:51:35",
        "创建时间": "2025-05-07 10:46:47",
        "Id": 11,
        "字段6": "更新一个数据111"
      }
    ]
  }
}

响应体示例 (成功更新多条):

{
  "msg": "更新成功",
  "code": 200,
  "data": {
    "updated_count": 2,
    "records": [
      {
        "最后更新时间": "2025-05-07 10:52:10",
        "创建时间": "2025-04-29 20:39:18",
        "Id": 7,
        "字段6": "更新一个数据"
      },
      {
        "最后更新时间": "2025-05-07 10:52:10",
        "创建时间": "2025-05-07 10:46:47",
        "Id": 11,
        "字段6": "更新一个数据111"
      }
    ]
  }
}

响应体示例 (部分成功，部分失败 - 记录不存在):

// 只返回更新成功的记录
{
  "msg": "更新成功",
  "code": 200,
  "data": {
    "updated_count": 1,
    "records": [
      {
        "最后更新时间": "2025-05-07 10:51:35",
        "创建时间": "2025-05-07 10:46:47",
        "Id": 11,
        "字段6": "更新一个数据111"
      }
    ]
  }
}

XML 语法

<!-- XML 调用格式，待开发同学提供 -->
<UpdateRecord baseId="{{base_id}}" tableId="{{table_id}}">
  <Updates type="json"> <!-- 输入参数名为 Updates -->
    <![CDATA[
      [
        { "record_id": "rec_abc111", "update_data": { "状态": "已完成", "完成时间": "..." } },
        { "record_id": "rec_def222", "update_data": { "优先级": 1 } }
      ]
    ]]>
  </Updates>
  <!-- 系统会自动填充 token 和 workspaceID -->
</UpdateRecord>


Groovy 语法

// Groovy 调用格式，待开发同学提供
// 示例结构

// 场景一：更新单条记录
def singleUpdate = [
  [ // 注意数组括号
    "record_id": "rec_jkl012",
    "update_data": [
      "状态": "已归档"
    ]
  ]
]
def updateSingleResult = engine.execute('UpdateRecord', [
  base_id: 'base_xyz789',
  table_id: 'tbl_abc123',
  updates: singleUpdate
])

if (updateSingleResult.success && updateSingleResult.output.updated_count > 0) {
  // 直接访问返回的完整记录
  def theUpdatedRecord = updateSingleResult.output.records[0]
  println("Record ${theUpdatedRecord.record_id} updated:")
  println("  状态: " + theUpdatedRecord.'状态')
  // ...
} else if (updateSingleResult.success && updateSingleResult.output.failed_count > 0) {
   println("Failed to update record: " + updateSingleResult.output.errors[0].message)
} else {
  println("Failed to process update request: " + (updateSingleResult.error?.message ?: updateSingleResult.output?.message ?: 'Unknown error'))
}

// 场景二：批量更新
def multipleUpdates = [
  [ "record_id": "rec_abc", "update_data": ["状态": "完成"] ],
  [ "record_id": "rec_def", "update_data": ["优先级": "高"] ],
  [ "record_id": "rec_nonexistent", "update_data": ["状态": "未知"] ] // 潜在错误
]
def updateMultipleResult = engine.execute('UpdateRecord', [
  base_id: 'base_xyz789',
  table_id: 'tbl_abc123',
  updates: multipleUpdates
])

if (updateMultipleResult.success) {
  println("Update operation processed.")
  println("Successfully updated: ${updateMultipleResult.output.updated_count} records.")
  if (updateMultipleResult.output.records) {
      println("Updated Records (full info):")
      updateMultipleResult.output.records.each { rec -> println("  ID: ${rec.record_id}, Status: ${rec.'状态'}") } // 示例访问状态
  }
  if (updateMultipleResult.output.failed_count > 0) {
    println("Failed to update: ${updateMultipleResult.output.failed_count} records.")
    updateMultipleResult.output.errors.each { err ->
      println("  Error (Record ID ${err.record_id}): ${err.message} (Code: ${err.error_code})")
    }
  }
} else {
   println("Failed to process batch update request: " + (updateMultipleResult.error?.message ?: 'Unknown error'))
}



使用案例

状态流转: 工作流中，一个审批节点通过后，可能需要更新多条相关联的记录。可以构造一个 updates 数组，包含所有需要更新的记录 ID 和对应的状态变化，一次性调用"编辑记录"完成。输出的 records 字段可以直接用于后续节点判断更新后的状态或其他信息。

批量修改: 用户在界面上选择了多个项目，并统一修改负责人。前端将选中的项目 ID 和新的负责人信息构造成 updates 数组，调用此指令进行批量更新。

分类与标签

数据库, Database, 数据表, Table, ABS, 更新, 编辑, 批量更新, Update, Edit, Batch Update, Record, Data Management, CRUD (Update)

错误码与异常说明

Http状态码

说明

处理建议

400

未知错误

查看日志，联系管理员。

401

身份验证失败

检查 Token。

403

权限不足 (编辑记录)

确认凭证权限。

404

节点不存在

确认 table_id。

权限与安全要求 (permission)

需要登录: 是。

涉及敏感操作: 可能。取决于所更新的数据是否敏感。

具体权限: 需要对目标 ABS 数据表拥有编辑/写入权限 (具体权限名称依 ABS 平台定义)。

数据安全: 传输的数据应考虑加密。

依赖关系与前置条件 (dependencies/prerequisites)

目标 ABS 数据库 (Base) 和数据表: 必须存在。

目标记录: updates 数组中指定的 record_id 必须存在才能被更新。

有效凭证: 系统必须能获取有效的 ABS Token。

字段知识: 设计者需了解目标表结构以构造 update_data。

前置节点: 通常需要前置节点获取 record_id 列表。