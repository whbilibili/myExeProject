<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç”¨æˆ·ç®¡ç† - ç”¨æˆ·åˆ—è¡¨</title>
  <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <div class="page-container" id="user-list-page">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <header class="page-header">
      <div class="breadcrumb">
        <span class="breadcrumb-item">ç³»ç»Ÿç®¡ç†</span>
        <span class="breadcrumb-item">ç”¨æˆ·ç®¡ç†</span>
      </div>
      <h1 class="page-title">ç”¨æˆ·ç®¡ç†</h1>
    </header>

    <!-- é¡µé¢å†…å®¹ -->
    <main class="page-content">
      <!-- ç­›é€‰åŒºåŸŸ -->
      <div class="filter-section">
        <div class="filter-grid">
          <div class="filter-item">
            <label class="filter-label">æœç´¢</label>
            <input 
              type="text" 
              class="input" 
              placeholder="ç­›é€‰ç”¨æˆ·åç§°ã€ç”¨æˆ·IDã€æ‰‹æœºå·ã€é‚®ç®±å·ã€MISå·"
              id="search-input"
            >
          </div>
          
          <div class="filter-item">
            <label class="filter-label">çŠ¶æ€</label>
            <select class="select" id="status-filter">
              <option value="all">å…¨éƒ¨</option>
              <option value="active">æ­£å¸¸</option>
              <option value="disabled">å·²ç¦ç”¨</option>
            </select>
          </div>
          
          <div class="filter-item">
            <label class="filter-label">å½’å±ç§Ÿæˆ·</label>
            <select class="select" id="tenant-filter">
              <option value="all">å…¨éƒ¨ç§Ÿæˆ·</option>
              <option value="TNT-001">è…¾è®¯ç§‘æŠ€</option>
              <option value="TNT-002">é˜¿é‡Œå·´å·´</option>
              <option value="TNT-003">å­—èŠ‚è·³åŠ¨</option>
              <option value="TNT-004">ç™¾åº¦åœ¨çº¿</option>
              <option value="TNT-005">ç½‘æ˜“å…¬å¸</option>
            </select>
          </div>
          
          <div class="filter-item">
            <label class="filter-label">åˆ›å»ºæ—¶é—´</label>
            <input 
              type="text" 
              class="input" 
              placeholder="é€‰æ‹©æ—¶é—´èŒƒå›´"
              id="date-range-filter"
            >
          </div>
          
          <div class="filter-item" style="align-self: flex-end;">
            <button class="btn btn-primary" onclick="applyFilters()">
              <span>ğŸ”</span>
              <span>æœç´¢</span>
            </button>
          </div>
          
          <div class="filter-item" style="align-self: flex-end;">
            <button class="btn btn-secondary" onclick="resetFilters()">
              <span>â†º</span>
              <span>é‡ç½®</span>
            </button>
          </div>
        </div>
      </div>

      <!-- æ•°æ®è¡¨æ ¼ -->
      <div class="table-container">
        <table class="table" id="users-table">
          <thead>
            <tr>
              <th>ç”¨æˆ·ID</th>
              <th>ç”¨æˆ·åç§°</th>
              <th>å½’å±ç§Ÿæˆ·</th>
              <th>ç»‘å®šæ‰‹æœº</th>
              <th>ç»‘å®šé‚®ç®±</th>
              <th>ç»‘å®šMIS</th>
              <th>åˆ›å»ºæ—¶é—´</th>
              <th>æœ€åç™»å½•æ—¶é—´</th>
              <th>çŠ¶æ€</th>
              <th>è´¦å·é‡‘é¢</th>
              <th style="width: 200px;">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="users-tbody">
            <!-- æ•°æ®è¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
          </tbody>
        </table>
        
        <!-- åˆ†é¡µ -->
        <div class="pagination">
          <div class="pagination-info">
            æ˜¾ç¤º <strong>1-6</strong> æ¡ï¼Œå…± <strong>6</strong> æ¡è®°å½•
          </div>
          <div class="pagination-controls">
            <button class="pagination-btn" disabled>ä¸Šä¸€é¡µ</button>
            <button class="pagination-btn active">1</button>
            <button class="pagination-btn" disabled>ä¸‹ä¸€é¡µ</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- é‡ç½®å¯†ç æ¨¡æ€æ¡† -->
  <div class="modal-overlay" id="reset-password-modal">
    <div class="modal" style="width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">é‡ç½®å¯†ç </h3>
        <button class="modal-close" onclick="hideModal('reset-password-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom: var(--spacing-lg);">
          <label class="filter-label">æ–°å¯†ç </label>
          <input type="password" class="input" placeholder="è¯·è¾“å…¥æ–°å¯†ç " id="new-password">
        </div>
        <div style="margin-bottom: var(--spacing-lg);">
          <label class="filter-label">ç¡®è®¤å¯†ç </label>
          <input type="password" class="input" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " id="confirm-password">
        </div>
        <div class="info-banner" style="margin-top: var(--spacing-lg);">
          <span class="info-banner-icon">âš ï¸</span>
          <span class="info-banner-text">é‡ç½®å¯†ç æ˜¯é«˜å±æ“ä½œï¼Œè¯·è°¨æ…æ“ä½œã€‚</span>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('reset-password-modal')">å–æ¶ˆ</button>
        <button class="btn btn-danger" onclick="confirmResetPassword()">ç¡®è®¤é‡ç½®</button>
      </div>
    </div>
  </div>

  <!-- æ³¨é”€è´¦å·æ¨¡æ€æ¡† -->
  <div class="modal-overlay" id="delete-user-modal">
    <div class="modal" style="width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">æ³¨é”€è´¦å·</h3>
        <button class="modal-close" onclick="hideModal('delete-user-modal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="info-banner" style="background: linear-gradient(135deg, #fff2f0 0%, #ffccc7 100%); border-left-color: var(--danger-color);">
          <span class="info-banner-icon">ğŸš¨</span>
          <span class="info-banner-text">æ³¨é”€è´¦å·æ˜¯ä¸å¯é€†æ“ä½œï¼Œè´¦å·ç›¸å…³çš„æ‰€æœ‰æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ï¼</span>
        </div>
        <div style="margin-top: var(--spacing-lg);">
          <label class="filter-label">è¯·è¾“å…¥"ç¡®è®¤æ³¨é”€"ä»¥ç»§ç»­</label>
          <input type="text" class="input" placeholder="ç¡®è®¤æ³¨é”€" id="delete-confirm-text">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="hideModal('delete-user-modal')">å–æ¶ˆ</button>
        <button class="btn btn-danger" onclick="confirmDeleteUser()">ç¡®è®¤æ³¨é”€</button>
      </div>
    </div>
  </div>

  <script src="js/mock-data.js"></script>
  <script src="js/main.js"></script>
  <script>
    let currentUserId = null;

    // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
    function renderUserList(users = mockUsers) {
      const tbody = document.getElementById('users-tbody');
      tbody.innerHTML = users.map(user => `
        <tr>
          <td>${user.id}</td>
          <td>
            <div class="avatar-group">
              <div class="avatar">${getAvatarText(user.name)}</div>
              <a href="user-detail.html?id=${user.id}" class="avatar-name clickable">${user.name}</a>
            </div>
          </td>
          <td>
            <div class="tooltip">
              <span>${user.tenants.slice(0, 2).join(', ')}</span>
              ${user.tenants.length > 2 ? `<span style="color: var(--text-tertiary);">... +${user.tenants.length - 2}</span>` : ''}
              ${user.tenants.length > 2 ? `<span class="tooltip-text">${user.tenants.join(', ')}</span>` : ''}
            </div>
          </td>
          <td>
            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
              <span>${user.phone}</span>
              <span class="copy-icon" onclick="copyToClipboard('${user.phone}')">ğŸ“‹</span>
            </div>
          </td>
          <td>
            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
              <span>${user.email}</span>
              <span class="copy-icon" onclick="copyToClipboard('${user.email}')">ğŸ“‹</span>
            </div>
          </td>
          <td>
            ${user.mis ? `
              <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                <span>${user.mis}</span>
                <span class="copy-icon" onclick="copyToClipboard('${user.mis}')">ğŸ“‹</span>
              </div>
            ` : '<span style="color: var(--text-tertiary);">-</span>'}
          </td>
          <td>${user.createdTime}</td>
          <td>${user.lastLoginTime}</td>
          <td>
            <span class="badge ${getStatusClass(user.status)}">
              ${getStatusText(user.status)}
            </span>
          </td>
          <td>
            <strong style="color: var(--primary-color);">${user.balance.toLocaleString()}</strong> wå¸
          </td>
          <td>
            <div class="table-actions">
              <button class="btn btn-text btn-sm" onclick="showResetPasswordModal('${user.id}')">
                é‡ç½®å¯†ç 
              </button>
              <button class="btn btn-text btn-sm" onclick="toggleUserStatus('${user.id}', '${user.status}')">
                ${user.status === 'active' ? 'ç¦ç”¨' : 'å¯ç”¨'}
              </button>
              <button class="btn btn-text btn-sm" style="color: var(--danger-color);" onclick="showDeleteUserModal('${user.id}')">
                æ³¨é”€
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // åº”ç”¨ç­›é€‰
    function applyFilters() {
      const searchText = document.getElementById('search-input').value.toLowerCase();
      const status = document.getElementById('status-filter').value;
      const tenant = document.getElementById('tenant-filter').value;
      
      let filtered = mockUsers;
      
      // æœç´¢ç­›é€‰
      if (searchText) {
        filtered = filtered.filter(user => 
          user.id.toLowerCase().includes(searchText) ||
          user.name.toLowerCase().includes(searchText) ||
          user.phone.includes(searchText) ||
          user.email.toLowerCase().includes(searchText) ||
          (user.mis && user.mis.toLowerCase().includes(searchText))
        );
      }
      
      // çŠ¶æ€ç­›é€‰
      if (status !== 'all') {
        filtered = filtered.filter(user => user.status === status);
      }
      
      // ç§Ÿæˆ·ç­›é€‰
      if (tenant !== 'all') {
        const tenantName = mockTenants.find(t => t.id === tenant)?.name;
        if (tenantName) {
          filtered = filtered.filter(user => user.tenants.includes(tenantName));
        }
      }
      
      renderUserList(filtered);
    }

    // é‡ç½®ç­›é€‰
    function resetFilters() {
      document.getElementById('search-input').value = '';
      document.getElementById('status-filter').value = 'all';
      document.getElementById('tenant-filter').value = 'all';
      document.getElementById('date-range-filter').value = '';
      renderUserList(mockUsers);
    }

    // æ˜¾ç¤ºé‡ç½®å¯†ç æ¨¡æ€æ¡†
    function showResetPasswordModal(userId) {
      currentUserId = userId;
      showModal('reset-password-modal');
    }

    // ç¡®è®¤é‡ç½®å¯†ç 
    function confirmResetPassword() {
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      
      if (!newPassword || !confirmPassword) {
        showErrorMessage('è¯·å¡«å†™å®Œæ•´çš„å¯†ç ä¿¡æ¯');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        showErrorMessage('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
        return;
      }
      
      // æ¨¡æ‹Ÿé‡ç½®å¯†ç 
      showSuccessMessage('å¯†ç é‡ç½®æˆåŠŸ');
      hideModal('reset-password-modal');
      document.getElementById('new-password').value = '';
      document.getElementById('confirm-password').value = '';
    }

    // åˆ‡æ¢ç”¨æˆ·çŠ¶æ€
    function toggleUserStatus(userId, currentStatus) {
      const action = currentStatus === 'active' ? 'ç¦ç”¨' : 'å¯ç”¨';
      const user = mockUsers.find(u => u.id === userId);
      
      showConfirmDialog(
        `${action}ç”¨æˆ·`,
        `ç¡®è®¤è¦${action}ç”¨æˆ· "${user.name}" å—ï¼Ÿ`,
        () => {
          // æ¨¡æ‹ŸçŠ¶æ€åˆ‡æ¢
          user.status = currentStatus === 'active' ? 'disabled' : 'active';
          renderUserList(mockUsers);
          showSuccessMessage(`ç”¨æˆ·å·²${action}`);
        }
      );
    }

    // æ˜¾ç¤ºæ³¨é”€ç”¨æˆ·æ¨¡æ€æ¡†
    function showDeleteUserModal(userId) {
      currentUserId = userId;
      showModal('delete-user-modal');
    }

    // ç¡®è®¤æ³¨é”€ç”¨æˆ·
    function confirmDeleteUser() {
      const confirmText = document.getElementById('delete-confirm-text').value;
      
      if (confirmText !== 'ç¡®è®¤æ³¨é”€') {
        showErrorMessage('è¯·è¾“å…¥"ç¡®è®¤æ³¨é”€"ä»¥ç»§ç»­');
        return;
      }
      
      // æ¨¡æ‹Ÿæ³¨é”€ç”¨æˆ·
      const index = mockUsers.findIndex(u => u.id === currentUserId);
      if (index > -1) {
        const userName = mockUsers[index].name;
        mockUsers.splice(index, 1);
        renderUserList(mockUsers);
        showSuccessMessage(`ç”¨æˆ· "${userName}" å·²æ³¨é”€`);
      }
      
      hideModal('delete-user-modal');
      document.getElementById('delete-confirm-text').value = '';
    }

    // é¡µé¢åŠ è½½æ—¶æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
    document.addEventListener('DOMContentLoaded', () => {
      renderUserList(mockUsers);
    });
  </script>
</body>
</html>


