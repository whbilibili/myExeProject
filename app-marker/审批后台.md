<!--
 * @Author: wanghong52 wanghong52@meituan.com
 * @Date: 2025-06-03 17:43:09
 * @LastEditors: wanghong52 wanghong52@meituan.com
 * @LastEditTime: 2025-06-03 17:43:14
 * @FilePath: /MyExeProject/app-marker/审批后台.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
# App包审批后台 - 产品方案

**目的:** 供管理员审核用户通过 "我上传的包" 功能提交的App包，并进行批准或拒绝操作。

**界面:** 一个简洁的表格列表，展示待审批和已处理的包。

## 1. 列表视图

### 1.1. 筛选与排序选项

*   **状态筛选:**
    *   `全部`
    *   `待审批` (默认选中)
    *   `已批准`
    *   `已拒绝`
*   **排序:**
    *   按 `上传时间` (最新优先 / 最旧优先)
    *   按 `提交用户` (A-Z / Z-A)

### 1.2. 表格列信息

| 列标题         | 内容描述                                         | 备注                                           |
| :------------- | :----------------------------------------------- | :--------------------------------------------- |
| **包名称**     | 用户提交时填写的 `PackageName`                   |                                                |
| **版本号**     | 用户提交时填写的 `Version`                       |                                                |
| **环境**       | 用户选择的包环境 (线上环境, 线下环境, 备机环境)   | (例如：通过 `getEnvironmentText()` 显示中文)     |
| **提交用户**   | 上传该包的用户 `uploaderDisplayName`             | (例如："张三")                                  |
| **上传时间**   | `uploadTime` (格式化显示，例如：YYYY-MM-DD HH:mm) |                                                |
| **包描述**     | 用户提交的 `PackageDescription`                  | 可提供tooltip或点击展开查看完整描述              |
| **PackageID**  | 系统生成的 `packageId`                           |                                                |
| **操作**       | 包含审批动作的按钮组                             | 见下方详细描述                                 |
| **当前状态**   | 包的 `status` (待审批, 已批准, 已拒绝)         |                                                |
| **审批人**     | (可选) 执行审批操作的管理员用户名                | 仅对已批准/已拒绝的包显示                      |
| **审批时间**   | (可选) 执行审批操作的时间                        | 仅对已批准/已拒绝的包显示                      |
| **审批备注**   | (可选) 管理员在拒绝时填写的理由                  | 仅对已拒绝的包显示，可点击图标或链接查看详情     |

---

### 1.3. 行内操作按钮 (主要针对 "待审批" 状态的包)

1.  **`下载包`**
    *   **类型:** 图标按钮 (例如：下载图标)
    *   **功能:** 点击后，管理员可以下载用户上传的包文件 (通过 `PackageURL`) 以便进行审查。

2.  **`批准`**
    *   **类型:** 主要操作按钮
    *   **功能:**
        *   点击后，该包的 `status` 更新为 `approved`。
        *   *(可选)* 记录执行此操作的管理员用户名和当前时间戳到包对象的 `审批人` 和 `审批时间` 字段。
        *   *(可选)* 系统触发通知给提交包的用户，告知其包已获批准。
        *   此包的 "操作" 列中 "批准" 和 "拒绝" 按钮变为不可用，或替换为 "已批准" 的文本状态。

3.  **`拒绝`**
    *   **类型:** 次要/危险操作按钮
    *   **功能:**
        *   点击后，弹出一个简易对话框/模态框。
        *   对话框内包含一个文本区域，供管理员填写**拒绝理由** (此字段为可选，但强烈建议填写以供用户参考)。
        *   对话框包含 "确认拒绝" 和 "取消" 按钮。
        *   若管理员点击 "确认拒绝":
            *   该包的 `status` 更新为 `rejected`。
            *   如果填写了拒绝理由，保存到包对象的 `审批备注` 字段。
            *   *(可选)* 记录执行此操作的管理员用户名和当前时间戳。
            *   *(可选)* 系统触发通知给提交包的用户，告知其包已被拒绝，并附带管理员填写的拒绝理由。
            *   此包的 "操作" 列中 "批准" 和 "拒绝" 按钮变为不可用，或替换为 "已拒绝" 的文本状态。

---

### 1.4. 行内操作 (针对 "已批准" 或 "已拒绝" 状态的包)

*   **(可选) 查看详情/修改审批:**
    *   可以提供一个 "查看" 或 "详情" 按钮/链接，点击后可以：
        *   显示完整的包信息，包括所有在主列表中未完全展示的字段（如完整描述、审批备注等）。
        *   如果业务逻辑允许，管理员可以修改之前的审批决定（例如，将一个误操作拒绝的包改为批准，或反之）。此操作应谨慎设计，并可能需要额外的权限和审计日志。
        *   允许管理员补充或修改审批备注。

## 2. 交互与视觉提示

*   **高亮显示:** "待审批" 状态的包在列表中可以使用特殊的背景色或边框进行高亮，以吸引管理员的注意力，提示优先处理。
*   **批量操作:** (高级功能，可选) 如果预计审批量很大，可以考虑支持管理员选择多个 "待审批" 的包进行批量批准。批量拒绝通常需要更谨慎的处理，可能不适合初版。
*   **响应式设计:** 列表界面应能良好地适应不同大小的屏幕和设备。
*   **加载与空状态:** 为列表加载数据时提供加载指示器。当筛选结果为空时（例如，没有"待审批"的包），显示友好的空状态提示信息。

## 3. 后端数据与API需求（概要）

*   **获取包列表API:**
    *   支持按状态、提交用户等条件筛选。
    *   支持分页。
    *   支持按指定字段排序。
*   **更新包状态API (审批接口):**
    *   接收包ID、新的状态 (`approved` / `rejected`)。
    *   接收可选的审批备注 (主要用于拒绝时)。
    *   后端应记录操作的管理员和时间。
*   **获取包文件API:** 提供安全的下载链接或流式传输包文件。

此设计方案旨在提供一个功能完整且易于使用的基础审批后台。具体的字段展示、操作权限和流程细节可根据实际业务需求进一步调整和细化。
