# "App市场" 功能产品方案 (V-Current Implementation)

## 1. 项目概述

本文档旨在详细描述 Bots 平台 "App市场" 功能的当前实现。该功能为平台用户提供一个发现官方管理的应用以及贡献自己应用包的界面与机制。这些应用包主要服务于 Bots 平台的工作流构建。

## 2. 功能目标

*   **统一的应用发现平台:** 提供 "App市场" 作为集中展示所有官方管理的应用（包含司内来源和司外来源）。
*   **用户包贡献与审批流程:** 允许用户通过 "我上传的包" 标签页贡献新的应用包，这些包将经过审批流程后才可能被使用。
*   **清晰的版本与环境管理:** 确保每个包拥有清晰的版本号、环境标识 (线上、线下、备机) 和唯一的 PackageID。
*   **简化的用户交互:** 用户主要角色是发现应用和贡献独立的包，应用本身的创建和市场管理由管理员负责。

## 3. 核心概念与术语

*   **App市场 (App Market):**
    *   平台的主标签页，用于展示所有由管理员维护的应用。
    *   **应用 (Application):**
        *   代表一个具有特定功能的智能体应用。
        *   **属性 (对用户可见):**
            *   `应用ID (AppID)`: 系统内部标识。
            *   `应用名称 (AppName)`: 清晰表明应用功能，可能包含平台指示。
            *   `应用描述 (AppDescription)`: 应用功能、用途的描述。
            *   `应用图标 (AppIcon)`: 应用的视觉标识。
            *   `平台类型 (PlatformType)`: 如 Android, iOS。
            *   `来源类型 (AppSourceType)`: 标签，如 "司内来源" 或 "司外来源"。
            *   `创建者 (CreatorDisplayName)`: 显示应用的创建者/管理者名称。
            *   `最新版本 (LatestVersion)`: 该应用下最新包的版本号。
            *   `最近更新 (LastUpdateTime)`: 该应用下最新包的上传时间。
        *   应用本身由管理员创建和管理，用户不能在前端直接创建或编辑 "App市场" 中的应用。

*   **我上传的包 (My Uploaded Packages):**
    *   用户专属的标签页，用于上传和管理用户自己贡献的独立应用包。
    *   **包 (Package):**
        *   用户贡献的、等待审批的应用包。
        *   **属性:**
            *   `包ID (PackageID)`: 系统生成的唯一标识。
            *   `PackageURL`: 系统生成的包下载链接。
            *   `包名称 (PackageName)`: 用户为该独立包定义的名称。
            *   `版本号 (Version)`: 包的版本。
            *   `包描述 (PackageDescription)`: 该版本包的特定更新说明或备注。
            *   `包文件 (PackageFile)`: 用户上传的实际应用包文件。
            *   `环境 (Environment)`: 包适用的环境（线上环境、线下环境、备机环境）。
            *   `上传者 (UploaderDisplayName)`: 固定为当前用户 ("我")。
            *   `上传时间 (UploadTime)`: 包上传的时间。
            *   `状态 (Status)`: 包的审批状态（待审批、已批准、已拒绝）。

## 4. 功能模块详述

### 4.1. 主界面与导航

*   **标题:** "App市场"
*   **副标题:** "发现、管理App及贡献App包。"
*   **顶部标签页 (Tabs):**
    *   **App市场 (App Market):** 默认选中的标签页。以卡片视图展示官方管理的所有应用。
    *   **我上传的包 (My Uploaded Packages):** 以列表视图展示当前用户上传的包及其状态。

*   **4.1.2. 搜索功能:**
    *   位于标签页导航栏下方，提供全局内容搜索能力。
    *   **在 "App市场" 标签页激活时:** 用户可按应用名称、应用描述、创建者等关键词进行搜索。
    *   **在 "我上传的包" 标签页激活时:** 用户可按包名称、版本号、包描述、PackageID 进行搜索。
    *   **在查看某应用的包列表详情页时:** 用户可按包版本、描述、PackageID 进行搜索。
    *   **无用户可操作的筛选器功能。** "新建应用"按钮对用户隐藏。

### 4.2. "App市场 (App Market)" 标签页

此区域展示所有官方管理的应用。

*   **4.2.1. 应用列表视图 (Application Card View):**
    *   **展示内容:** 以卡片形式展示所有应用。
    *   **卡片展示信息:**
        *   应用图标 (`AppIcon`)
        *   应用名称 (`AppName`)
        *   平台类型 (`PlatformType`) - 以标签形式展示。
        *   来源类型 (`AppSourceType`) - 以标签形式展示 ("司内来源" / "司外来源")。
        *   应用描述 (`AppDescription`) - 截断显示。
        *   最新版本 (`LatestVersion`)
        *   最近更新 (`LastUpdateTime`)
        *   创建者 (`CreatorDisplayName`)
    *   **卡片操作:**
        *   点击卡片区域或 "查看版本列表 &rarr;" 按钮: 跳转至该应用的包列表详情页 (见 4.2.2)。
    *   **用户权限:** 用户在此页面不能创建新应用、编辑应用信息或删除应用。这些操作由管理员执行。

*   **4.2.2. 应用包详情页 (Package Details Page - 查看App市场应用的包):**
    *   当用户从 "App市场" 点击某个应用卡片后进入此页面。
    *   **页面结构与功能:**
        *   **导航:** 提供 "返回 App市场" 的按钮。
        *   **应用信息概要:** 展示当前应用的图标、名称、描述、创建者、来源类型。
        *   **顶部操作栏:**
            *   **包搜索:** 仅针对当前应用下包列表的搜索框。
            *   **无 "为此应用上传包" 按钮:** 用户不能为 "App市场" 中的应用直接上传包。
    *   **包列表 (Package List):**
        *   以表格形式展示该应用下的所有包。
        *   **列表展示字段:**
            *   版本号 (`Version`)
            *   包描述 (`PackageDescription`) - 截断显示。
            *   PackageID (提供一键复制)
            *   PackageURL (提供一键复制)
            *   环境 (`Environment`) - 显示如 "线上环境"。
            *   上传者 (`UploaderDisplayName`)
            *   上传时间 (`UploadTime`)
            *   **操作 (Actions) 列:**
                *   下载包: 模拟下载。
                *   用户无权编辑或删除此处的包。

### 4.3. "我上传的包 (My Uploaded Packages)" 标签页

此区域允许用户贡献独立的包，并管理其上传的包。

*   **4.3.1. 包列表视图 (Package List View):**
    *   **顶部操作:**
        *   搜索框 (详情见 4.1.2)。
        *   **`[+] 上传新包` 按钮:** 点击后打开 "上传新包" 弹窗 (4.3.2)。
    *   **列表展示字段:**
        *   **包名称 (`PackageName`):** 用户定义的包的名称。
        *   **版本号 (`Version`)**
        *   **版本描述 (`PackageDescription`)** - 截断显示。
        *   **PackageID** (提供一键复制)
        *   **PackageURL** (提供一键复制)
        *   **环境 (`Environment`)** - 显示如 "线上环境"。
        *   **上传时间 (`UploadTime`)**
        *   **状态 (`Status`):** 显示包的审批状态 ("待审批", "已批准", "已拒绝")。
        *   **操作 (Actions) 列:**
            *   下载 (模拟)
            *   编辑: 仅当包状态为 "待审批" 或 "已拒绝" 时可见。点击打开 "编辑包信息" 弹窗 (4.3.3)。
            *   删除: 仅当包状态为 "待审批" 或 "已拒绝" 时可见。操作需二次确认。
    *   **交互特性:** 列表默认按上传时间降序排序。

*   **4.3.2. "上传新包" 弹窗 (用于 "我上传的包"):**
    *   **标题:** "上传新包"
    *   **表单字段:**
        *   **包名称 (`PackageName`):** (必填项) 文本输入。
        *   **环境 (`Environment`):** (必填项) 下拉选择 (线上环境, 线下环境, 备机环境)。默认 "线上环境"。
        *   **应用包文件 (`PackageFile`):** (必填项) 标准文件上传控件。
        *   **版本号 (`Version`):** (必填项) 文本输入。
        *   **包描述 (`PackageDescription`):** (可选项) 文本区域。
    *   **提交操作:** "确认上传"。
    *   **系统行为:**
        *   创建新的包记录，`appId` 为 `null` (不直接关联App市场应用)。
        *   `uploader` 为当前用户。
        *   `status` 默认为 `pending_approval`。
        *   自动生成 `PackageID` 和 `PackageURL` (模拟)。
        *   成功后，新包出现在 "我上传的包" 列表中。

*   **4.3.3. "编辑包信息" 弹窗 (用于 "我上传的包"):**
    *   **触发:** 在 "我上传的包" 列表中，对状态为 "待审批" 或 "已拒绝" 的包点击 "编辑"。
    *   **标题:** "编辑包信息"
    *   **副标题:** 显示 "包: [包名称] - 版本: [版本号]"
    *   **表单字段:**
        *   **包名称 (`PackageName`):** (必填项) 文本输入。
        *   **环境 (`Environment`):** (必填项) 下拉选择。可编辑。
        *   **版本号 (`Version`):** (必填项) 文本输入。可编辑。
        *   **包描述 (`PackageDescription`):** (可选项) 文本区域。可编辑。
    *   **提交操作:** "保存更改"。
    *   **系统行为:**
        *   更新对应包的信息。
        *   如果原状态是 "已拒绝"，更新后状态会变为 "待审批"。

## 5. 核心权限与管理逻辑

*   **App (应用) 创建与管理:**
    *   所有在 "App市场" 中展示的应用（包括 "司内来源" 和 "司外来源"）均由**管理员**在后台创建和统一管理。
    *   普通用户**不能**通过前端界面创建、编辑或删除 "App市场" 中的应用。

*   **Package (包) 上传与管理:**
    *   **用户贡献:** 用户通过 "我上传的包" 标签页上传新的独立的包。这些包在上传后进入 "待审批" 状态。
    *   **审批流程:** 上传的包需要管理员在后台进行审批。审批结果可以是 "已批准" 或 "已拒绝"。
        *   "已批准" 的包后续如何被使用或关联到具体应用，取决于后续的业务流程和后台管理功能（本文档未定义此部分）。
    *   **用户管理权限:**
        *   用户可以编辑或删除自己上传的、且状态为 "待审批" 或 "已拒绝" 的包。
        *   用户不能管理或修改 "App市场" 中展示的应用下的任何包。
        *   用户不能管理或修改其他用户上传的包。
*   **环境字段:**
    *   用户在上传或编辑自己的包时，需要指定包适用的环境（线上、线下、备机）。
    *   "App市场" 中的应用包也会展示其设定的环境。

## 6. 技术与运营考量

*   **PackageID与PackageURL唯一性:** 后端需确保每个上传的 `PackageID` 和生成的 `PackageURL` 是唯一的。
*   **后台管理系统:** 强大的后台管理系统是此方案的核心，应支持：
    *   管理员对 "App市场" 应用的完整 CRUD 操作。
    *   管理员对用户上传包的审批（批准、拒绝）、管理和可能的关联操作。
    *   用户权限管理。
*   **用户通知:** 当用户上传的包被审批（批准/拒绝）或被管理员操作时，应有通知机制。
